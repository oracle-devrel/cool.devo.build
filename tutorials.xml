<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://cool.devo.build/tutorials.xml" rel="self" type="application/atom+xml" /><link href="https://cool.devo.build/" rel="alternate" type="text/html" /><updated>2023-01-17T15:45:44+00:00</updated><id>https://cool.devo.build/tutorials.xml</id><title type="html">Oracle Developer Tutorials | Pages</title><subtitle>Cool stuff from Oracle's Developer Relations team</subtitle><author><name>Oracle Developer Community</name></author><entry><title type="html">Getting started with Rust</title><link href="https://cool.devo.build/tutorials/rust-on-oci/rust-getting-started" rel="alternate" type="text/html" title="Getting started with Rust" /><published>2022-12-12T08:00:00+00:00</published><updated>2022-12-12T08:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/rust-on-oci/rust-getting-started"><![CDATA[<figure class="alignleft 250 250">
              <picture>
                  <source srcset="media/image2.png 1x" />
                  <img loading="lazy" src="media/image2.png" data-original="media/image2.png" title="Rust Logo" alt="Rust Logo" />
              </picture>
              <figcaption>Rust Logo</figcaption>
            </figure>
<figure class="alignleft 250 250">
              <picture>
                  <source srcset="media/image1.png 1x" />
                  <img loading="lazy" src="media/image1.png" data-original="media/image1.png" title="Rust Cargo Logo" alt="Rust Cargo Logo" />
              </picture>
              <figcaption>Rust Cargo Logo</figcaption>
            </figure>
<figure class="alignleft 250 250">
              <picture>
                  <source srcset="media/image4.png 1x" />
                  <img loading="lazy" src="media/image4.png" data-original="media/image4.png" title="Ferris the crab, unofficial mascot" alt="Ferris the crab, unofficial mascot" />
              </picture>
              <figcaption>Ferris the crab, unofficial mascot</figcaption>
            </figure>

<p>Welcome to a series of posts on “Everything you need to know about Rust.” We’ll cover a lot over the course of the next few articles. By the end, you should be comfortable with writing and deploying your own Rust project and be ready to jump into advanced topics.</p>

<p>This first article will introduce you to the motivations behind Rust, why you might use Rust, and a walkthrough of a simple Rust application deployed to Oracle Cloud Infrastructure. Later articles will cover the ecosystem and full suite of Rust tools, publishing Rust libraries (known as “crates”), and best practices and resources for becoming a Rust expert.</p>

<p>Let’s kick it off with a few fundamentals.</p>

<h2 id="what-is-rust">What Is Rust?</h2>

<p><strong>Rust</strong> is a general-purpose programming language developed</p>

<p>specifically to run blazingly fast, enforce type safety, and provide concurrency, all in an easier-to-use language than its predecessors, such as C and C++. It’s a relatively new language, with version 1.0 released in 2015.</p>

<p>Rust enforces memory safety through <a href="https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html">its unique ownership system</a>, which ensures that all resources are properly initialized and cleaned up, preventing you from using a resource before it has been initialized or after it has been freed. By enforcing such strict memory guarantees, Rust programs don’t need to be garbage-collected. Rust also has <a href="https://doc.rust-lang.org/book/ch16-00-concurrency.html">strong support for multithreading</a>. In other languages, multithreading can lead to concurrency problems such as resource deadlocks. But by using the ownership system, Rust tracks and catches potential data races at <em>compile time</em>, making it much easier to write safe, concurrent code.</p>

<p>Many of Rust’s goals are closely aligned with <a href="https://www.oracle.com/cloud/why-oci/">Oracle Cloud Infrastructure (OCI)</a>, which makes the two technologies a great pair if you’re looking to provide greater security, performance, <em>and</em> flexibility to your development projects.</p>

<h2 id="why-use-rust">Why Use Rust?</h2>

<p>While Rust is definitely a general-purpose language, there are some common use cases where it truly shines.</p>

<p>First are <strong><a href="https://www.rust-lang.org/what/networking">networking</a> and <a href="https://www.rust-lang.org/what/embedded">embedded</a> devices.</strong> One of the main motivators for Rust’s development was to create a language that would be suitable for use in systems programming contexts, such as operating systems, device drivers, and embedded systems. Since well-written Rust applications have a small footprint and writing safe, concurrent code is a basic part of developing in the language, Rust is perfect for low-resource deployments that are often found in both of these spaces.</p>

<p>Next, since Rust became prominent when Mozilla sponsored it during a high point of web development, it should be no surprise that Rust has great <strong>web-related applications</strong>. Whether you need to have all the benefits of the language on the front end or back end of your web stack, you can use Rust.</p>

<ul>
  <li>For front-end functionality that needs high performance, developers often build in Rust and <a href="https://www.rust-lang.org/what/wasm">compile to WebAssembly</a> to run in a browser. With client-side code that is known to be safe, you can be more certain of success for whatever high-performance tasks you need.</li>
  <li>For back-end applications, Rust has several web frameworks, such as <a href="https://actix.rs">Actix Web</a> and <a href="https://rocket.rs">Rocket</a>, that can provide the tools and libraries you need to quickly spin up fast and secure web applications that take advantage of Rust.</li>
</ul>

<p>Finally, Rust is also great for <strong><a href="https://www.rust-lang.org/what/cli">building command-line tools</a></strong>. With its easy distribution model (via <a href="https://crates.io">crates.io</a>, its package distributor) and the ability to run on many different CPU architectures, Rust allows safety and performance without having to worry about the intricacies of its deployment environment.</p>

<h2 id="how-is-rust-different-from-javascript">How Is Rust Different from JavaScript?</h2>

<p>You may be wondering how Rust is different from JavaScript or other scripting languages. There are a few key differences to consider.</p>

<ul>
  <li>First, Rust is a statically typed language, while JavaScript is dynamically typed. This means that in Rust, you have to declare the types of variables ahead of time, while in JavaScript, you don’t need to do this.</li>
  <li>Second, Rust is compiled to native code, while JavaScript is interpreted by a virtual machine. This means that Rust programs will generally run faster than JavaScript programs, but they may take longer to compile.</li>
  <li>Finally, Rust has several features that make it more suitable for use in systems programming contexts than JavaScript. These include its focus on safety and security, its low-level control over memory management and data layout, and its support for efficient code.</li>
</ul>

<h2 id="lets-see-it-in-action">Let’s See It in Action</h2>

<p>Now that we have some background, let’s get Rust up and running on an OCI instance and see how easy it can be to get started.</p>

<p>If you don’t have an OCI account, the first step is to create one. For simplicity and ease of following along, we’ll start with <a href="https://www.oracle.com/cloud/free/">an Always Free Instance</a> and create a simple Actix web app. This app will be very similar to a demo Express.js application. It’s a single-file app that responds with a greeting on a couple of GET routes and will echo the payload sent via POST on another route.</p>

<p>Everything we use here is free, so no worries about costs.</p>

<h3 id="in-order-to-bake-a-rust-app-you-must-first-invent-a-computing-universe">In order to bake a Rust app, you must first invent a computing universe</h3>

<p>If you really wanted to go quickly, you could start by creating a bare Linux instance on OCI, install Rust, then build your Actix app. However, if you want to be able to access your app from the internet, or do more than just write to the local drive, there’s a bit more involved.</p>

<p>We’ll walk through the relevant steps below, but if you need more detailed information, check <a href="https://docs.oracle.com/en-us/iaas/Content/GSG/Reference/overviewworkflow.htm#Tutorial__Launching_Your_First_Linux_Instance">this more thorough
tutorial</a>.</p>

<h4 id="initial-setup">Initial setup</h4>

<p>Our first step is to <a href="https://docs.oracle.com/en-us/iaas/Content/GSG/Tasks/choosingcompartments.htm#Choosing_a_Compartment">choose a compartment</a> where we’ll put this sample app. If you’ve never created a compartment before, you’ll have a default “root” compartment for your account, but it’s a better idea to create a new one. We won’t be creating much for this article, but having a dedicated compartment will make cleanup easier. It’s simple to create one, so we’ll make a sandbox compartment from the Identity &amp; Security menu.</p>

<picture class="">
                <source srcset="media/image8.png 1x" />
                <img loading="lazy" src="media/image8.png" data-original="media/image8.png" />
            </picture>

<p><em>Choose “Compartments” from the menu for Identity &amp; Security</em></p>

<p>Once you get to the list of compartments, you can make a new one and fill in these details (or something like them), but keep the Parent Compartment set to your root compartment.</p>

<picture class="">
                <source srcset="media/image3.png 1x" />
                <img loading="lazy" src="media/image3.png" data-original="media/image3.png" />
            </picture>

<p>Now that you have a compartment that won’t cause problems for other things in the rest of your account, let’s get to work.</p>

<h4 id="an-internet-accessible-network">An internet accessible network</h4>

<p>In any new OCI account, you’ll start with a purely private network. This means that any resources you create will be able to talk to one another, but by default, none of them will be accessible to the rest of the internet.</p>

<p>Since we’re building a web app, that simply won’t work for our needs, so we’re going to need to create <a href="https://docs.oracle.com/en-us/iaas/Content/GSG/Tasks/creatingnetwork.htm#Creating_a_Virtual_Cloud_Network">an internet-connected Virtual Cloud Network</a>. OCI is designed to get us up and running quickly and offers just what we need through a convenient wizard on the networking page.</p>

<p>If you choose our sandbox compartment from the sidebar and click the “Start VCN Wizard” button, you’ll see something like this.</p>

<picture class="">
                <source srcset="media/image7.png 1x" />
                <img loading="lazy" src="media/image7.png" data-original="media/image7.png" />
            </picture>

<p>Start the wizard and pick a name for your network (e.g. RustNet or whatever you feel like). Leave the CIDR blocks and other settings alone, then click next.</p>

<picture class="">
                <source srcset="media/image5.png 1x" />
                <img loading="lazy" src="media/image5.png" data-original="media/image5.png" />
            </picture>

<p>You should see a number of gateways that will be created, as well as some security lists and route tables. Click create and watch OCI do its work.</p>

<p>While you’re here, open the Default Security List from the Security Lists tab and add a rule to allow traffic on port 8080 to your VNC. The settings should look like this:</p>

<picture class="">
                <source srcset="media/image6.png 1x" />
                <img loading="lazy" src="media/image6.png" data-original="media/image6.png" />
            </picture>

<h4 id="building-our-compute-instance">Building our compute instance</h4>

<p>Now we get to <a href="https://docs.oracle.com/en-us/iaas/Content/GSG/Tasks/launchinginstance.htm#Launching_a_Linux_Instance">make our computer</a> for building a Rust app. We’ll use the basic defaults (they’re set to use the Always Free options), and we’ll download the SSH key that’s generated with our instance. The defaults are good enough for our purposes, so once you’ve given your instance a name and have checked that your VCN is being used for this instance, just click the Create button.</p>

<p>Once your instance has been provisioned, grab the IP address and get ready to start working in the cloud!</p>

<h3 id="getting-up-and-running-with-rust">Getting up and running with Rust</h3>

<p>By default, Rust is not installed in OCI instances. However, just as OCI is designed for ease of use and setup, Rust is constantly striving for developer efficiency, and the setup process is no exception. The rustup command is designed to make setting up Rust as painless as possible.</p>

<p><a href="https://www.rust-lang.org/tools/install">Grab the installation command from the docs</a>, and run it on your OCI instance. When you see “Rust is installed now. Great!” you’re ready to go, with a full Rust tool suite installed. These tools include rustup itself, which will allow you to maintain your Rust tools in the future, rustc, which is the Rust compiler, and cargo, which serves as Rust’s package manager. Cargo has many other uses too, including making new Rust apps and libraries from scratch.</p>

<p>Make sure to check if there are any instructions to get your current shell configured properly. If there are, run those commands. If you like, you can verify that everything was installed correctly with:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">rustc --version
</span></code></pre></div></div>

<p>This should give you the most recent and stable version of Rust.</p>

<h3 id="configuring-our-app">Configuring our app</h3>

<p><a href="https://actix.rs/docs/getting-started/">Getting a new Actix app going</a> is pretty straightforward. You start, as you do with many Rust projects, with:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">cargo new hello-rust
</span></code></pre></div></div>

<p><strong>Cargo</strong> is Rust’s dependency and app manager. It’s very similar to npm
for Node, Ruby’s bundler tool, or PyPI for Python. In our case, it only
creates a couple things for us. In a new directory called hello-rust,
Cargo will have created the following structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hello-rust\
├── Cargo.toml\
└── src\
└── main.rs
</code></pre></div></div>

<p>In Rust, packages are called crates. The Cargo.toml file serves as a package manifest) and the src/main.rs file is our main source file. We won’t need anything other than these two files for our Actix app.</p>

<p>In the Cargo.toml file, add the following line to the [dependencies] section:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[dependencies]
actix-web = "4"
</code></pre></div></div>

<p>Save your Cargo file and open the src/main.rs file. Replace what’s there with:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">actix_web</span><span class="p">::{</span><span class="n">get</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">web</span><span class="p">,</span> <span class="n">App</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpServer</span><span class="p">,</span> <span class="n">Responder</span><span class="p">};</span>

<span class="nd">#[get(</span><span class="s">"/"</span><span class="nd">)]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">hello</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Responder</span> <span class="p">{</span>
    <span class="nn">HttpResponse</span><span class="p">::</span><span class="nf">Ok</span><span class="p">()</span><span class="nf">.body</span><span class="p">(</span><span class="s">"Hello, Rust!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">#[post(</span><span class="s">"/echo"</span><span class="nd">)]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">echo</span><span class="p">(</span><span class="n">req_body</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Responder</span> <span class="p">{</span>
    <span class="nn">HttpResponse</span><span class="p">::</span><span class="nf">Ok</span><span class="p">()</span><span class="nf">.body</span><span class="p">(</span><span class="n">req_body</span><span class="p">)</span><span class="err">\</span>
<span class="p">}</span>

<span class="k">async</span> <span class="k">fn</span> <span class="nf">manual_hello</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Responder</span> <span class="p">{</span>
    <span class="nn">HttpResponse</span><span class="p">::</span><span class="nf">Ok</span><span class="p">()</span><span class="nf">.body</span><span class="p">(</span><span class="s">"Hey there!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">#[actix_web::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nn">HttpServer</span><span class="p">::</span><span class="nf">new</span><span class="p">(||</span> <span class="p">{</span>
        <span class="nn">App</span><span class="p">::</span><span class="nf">new</span><span class="p">()</span>
            <span class="nf">.service</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>
            <span class="nf">.service</span><span class="p">(</span><span class="n">echo</span><span class="p">)</span>
            <span class="nf">.route</span><span class="p">(</span><span class="s">"/hey"</span><span class="p">,</span> <span class="nn">web</span><span class="p">::</span><span class="nf">get</span><span class="p">()</span><span class="nf">.to</span><span class="p">(</span><span class="n">manual_hello</span><span class="p">))</span>
    <span class="p">})</span>
    <span class="nf">.bind</span><span class="p">((</span><span class="s">"0.0.0.0"</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span><span class="o">?</span>
    <span class="nf">.run</span><span class="p">()</span>
    <span class="k">.await</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This might feel like a lot, but with just the actix-web dependency and these few lines of code, we now have a fully functioning Rust web app.</p>

<p>This code, in the main function, is building an HTTP server that attaches to port 8080 of your instance. That server has two “services”</p>

<p>defined as asynchronous functions which will respond with a greeting at the root route with a GET or echo back a response at the /echo route. We’ve also established a third route manually with the .route call for the manual_hello function. Because all of these are defined using the async keyword, the app can respond to multiple requests at once as long as there are threads available. What’s nice is that we know the app is not going to have any memory safety issues because it compiles without errors.</p>

<p>We’ve already opened a rule on our network to allow traffic over port 8080, but we also need to open port 8080 in our firewall to allow traffic through, so run these two commands:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-port</span><span class="o">=</span>8080/tcp
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<p>Return to the root of your app and run:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>cargo run
</code></pre></div></div>

<p>Once you do, your application will build and start running.</p>

<p>If you grab the IP address of your instance and append port 8080, you should be able to get a “Hello, Rust!” from your browser. If you’d like to be a little more adventurous, you could send a POST to the /echo endpoint and get the request body you send echoed back. We’ve also manually set up a special hello at the /hey route. All of this in under 30 lines of Rust!</p>

<h1 id="conclusion">Conclusion</h1>

<p>There’s a lot more to learn, but hopefully you can see the power and ease of using Rust and OCI together. Future articles will dive deeper into Rust and the ecosystem. In the meantime, you might also enjoy getting a taste of what Rust can do by checking out <a href="https://doc.rust-lang.org/book/title-page.html">The Rust Programming Language</a>, affectionately referred to by Rust programmers as “The Book.” Alternatively, you can keep poking around with some of <a href="https://docs.oracle.com/en-us/iaas/Content/GSG/Concepts/baremetalintro.htm">the amazing things you can do on OCI</a> with the free trial credits you got for creating a new Oracle Cloud account.</p>]]></content><author><name>Oracle Developers</name></author><category term="clouddev" /><category term="cloudapps" /><category term="open-source" /><category term="devops" /><category term="get-started" /><category term="back-end" /><category term="rust" /><summary type="html"><![CDATA[The beginning of a series on building applications using the Rust programming language.]]></summary></entry><entry><title type="html">Building an API in Rust and hosting on Oracle Cloud Infrastructure</title><link href="https://cool.devo.build/tutorials/rust-on-oci/rust-building-an-api" rel="alternate" type="text/html" title="Building an API in Rust and hosting on Oracle Cloud Infrastructure" /><published>2022-12-12T08:00:00+00:00</published><updated>2022-12-12T08:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/rust-on-oci/rust-building-an-api"><![CDATA[<p>It’s impossible to work in cloud services without hearing about Rust, the system’s programming language from Mozilla. It’s used all over the internet by companies like <a href="https://blog.cloudflare.com/workers-rust-sdk/">Cloudflare</a>, <a href="https://engineering.fb.com/2021/04/29/developer-tools/rust/">Facebook</a>, and <a href="https://discord.com/blog/why-discord-is-switching-from-go-to-rust">Discord</a>. It’s a strongly-typed yet flexible language that emphasizes strict guidelines around memory usage, making it blazing fast and resource lean. The language also focuses on developer productivity, which is evident in their tooling and <a href="https://crates.io/">package ecosystems</a>.</p>

<p>Rust is being used in places where C worked best, due in part to its recognizable syntax. It is also replacing some higher-level languages, like Node and Ruby. In this blog post, we will build a small API microservice using Rust. APIs are generally used in situations where services—a server and a client—must communicate with each other. Our API will represent the backend for an inventory bookstore, where books can be added, fetched, and removed.</p>

<p>This app will be hosted on Oracle Cloud Infrastructure (OCI). OCI enables cloud-native containers to run in highly secure and performant environments that are also fully managed. This makes it a perfect match to host Rust applications, since the platform and the language are well-suited to solve similar problems.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before getting started, you’ll need to install several software packages.</p>

<p>First, you’ll need Rust. Regardless of your operating system, <a href="https://rustup.rs">the Rustup script</a> is guaranteed to work and installs all the necessary tools you need to start building a Rust application. You’ll also need to install <a href="https://www.docker.com">Docker</a> to test the app containerization locally.</p>

<p>In order to deploy the app online, you’ll also need <a href="https://www.oracle.com/cloud/free/?source=CloudFree_CTA1_Default&amp;intcmp=CloudFree_CTA1_Default">a free OCI account</a>.</p>

<h2 id="getting-started-with-the-rust-code">Getting started with the Rust code</h2>

<p>As with many programming languages, Rust comes with its own package management system called <a href="https://crates.io">Crates</a>. To start building our app, we will want an HTTP web framework to do the heavy lifting for us. There are many to choose from, but we’ll use <a href="https://github.com/seanmonstar/warp">warp</a>, as it’s both popular and performant. Just as Node uses package.json to manage packages, Rust uses Cargo.toml.</p>

<p>Create a new directory within which you can start building this project, and create a file named Cargo.toml in it. Paste these lines into that file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[package]
name = "server"
version = "0.1.0"
license = "MIT"
edition = "2018"

[dependencies]
tokio = { version = "1", features = ["full"] }
warp = "0.3"
serde = { version = "1", features = ["derive"]}
serde_json = "1.0"
</code></pre></div></div>

<p>Here, we’re defining the general metadata of our package. We’re specifying that we want to create a binary executable named server; we also have a list of dependencies that our project needs, including warp.</p>

<p>Next, create a directory called src, and a directory called bin within that. Then, create a file called server.rs, and paste these lines into it:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#![deny(warnings)]</span>
<span class="k">use</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Filter</span><span class="p">;</span>

<span class="nd">#[tokio::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Match any request and return hello world!</span>
    <span class="k">let</span> <span class="n">routes</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="nf">any</span><span class="p">()</span><span class="nf">.map</span><span class="p">(||</span> <span class="s">"Hello, World!"</span><span class="p">);</span>

    <span class="nn">warp</span><span class="p">::</span><span class="nf">serve</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span><span class="nf">.run</span><span class="p">(([</span><span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">3000</span><span class="p">))</span><span class="k">.await</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We’ve defined a very basic Warp server, which will run on <a href="http://127.0.0.1:3000">http://127.0.0.1:3000</a>. When a user visits that page, they’ll see a greeting. Go ahead and type <code class="language-plaintext highlighter-rouge">cargo run</code> on the terminal. Cargo will download all the dependencies you defined, then it’ll compile them together with the server.rs file to create an executable. (All of that in just one command!) When it’s finished, you’ll see the following message:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>cargo run
<span class="go">Finished dev [unoptimized + debuginfo] target(s) **in** 0.06s
Running `target/debug/server`
</span></code></pre></div></div>

<p>Navigate your browser window to <a href="http://127.0.0.1:3000">http://127.0.0.1:3000</a>, which should show the greeting, thus confirming that the initial project setup has worked!</p>

<h2 id="setting-up-an-api">Setting up an API</h2>

<p>Now that we have verified that our server runs correctly, it’s time to build a more proper API. We want our API to get a list of books, add a new book, and remove a book.</p>

<p>In a future blog, we will integrate with a backend database for storing and querying the data. To keep things simple in this tutorial, we’ll just fake the data store by defining an array to store all of our books.</p>

<p>Let’s start by defining the structure of a Book. Rust has the concept of structs, which are akin to lightweight classes. Here’s an example of what our Book class would look like:</p>

<p>(All the code below replaces the code in the server.rs file.)</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">serde</span><span class="p">::{</span><span class="n">Deserialize</span><span class="p">,</span> <span class="n">Serialize</span><span class="p">};</span>                                  
                                                                     
<span class="nd">#[derive(Clone,</span> <span class="nd">Serialize,</span> <span class="nd">Deserialize)]</span>                            
<span class="k">pub</span> <span class="k">struct</span> <span class="n">Book</span> <span class="p">{</span>                                                  
  <span class="n">title</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>                                                       
  <span class="n">author</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="n">year</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can then modify our main function to immediately set up a basic catalog of books that follow this structure. We will use a vector (which is like an expandable array), and store the list in memory:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">sync</span><span class="p">::</span><span class="nb">Arc</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">tokio</span><span class="p">::</span><span class="nn">sync</span><span class="p">::</span><span class="n">Mutex</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">type</span> <span class="n">Db</span> <span class="o">=</span> <span class="nb">Arc</span><span class="o">&lt;</span><span class="n">Mutex</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;&gt;&gt;</span><span class="p">;</span>

<span class="nd">#[tokio::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">let</span> <span class="k">mut</span> <span class="n">book_catalog</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"The Hitchhiker's Guide to the Galaxy"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1979</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"The Restaurant at the End of the Universe"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1980</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"Life, the Universe and Everything"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1982</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"So Long, and Thanks for All the Fish"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1984</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"Mostly Harmless"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1992</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="k">let</span> <span class="n">db</span> <span class="o">=</span> <span class="nn">Arc</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nn">Mutex</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">book_catalog</span><span class="p">));</span>
</code></pre></div></div>

<p>So far, so good? Right on!</p>

<p>The next task is to add routes to this API. There are a number of patterns to implement this, but the one suggested by Warp takes a two-pronged approach: First, the routes are defined, and then, the implementation of those routes is defined. This way, the implementation can change, but the route information can be considered static and stable.</p>

<p>Let’s go ahead and define these routes. We’ll drop the code first, and then provide a closer examination:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mod</span> <span class="n">filters</span> <span class="p">{</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Db</span><span class="p">;</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Book</span><span class="p">;</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">handlers</span><span class="p">;</span>
  <span class="k">use</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Filter</span><span class="p">;</span>
  <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">convert</span><span class="p">::</span><span class="n">Infallible</span><span class="p">;</span>

  <span class="cd">/// The routes, combined.</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">construct_book_routes</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nf">route_get_books</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">())</span>
      <span class="nf">.or</span><span class="p">(</span><span class="nf">route_post_books</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">()))</span>
      <span class="nf">.or</span><span class="p">(</span><span class="nf">route_delete_book</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">()))</span>
  <span class="p">}</span>

  <span class="cd">/// GET /books</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">route_get_books</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nd">path!</span><span class="p">(</span><span class="s">"books"</span><span class="p">)</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nf">get</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
      <span class="nf">.and_then</span><span class="p">(</span><span class="nn">handlers</span><span class="p">::</span><span class="n">get_books</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="cd">/// POST /books with JSON body</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">route_post_books</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nd">path!</span><span class="p">(</span><span class="s">"books"</span><span class="p">)</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nf">post</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">json_body</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
      <span class="nf">.and_then</span><span class="p">(</span><span class="nn">handlers</span><span class="p">::</span><span class="n">create_book</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="cd">/// DELETE /books/:id</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">route_delete_book</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nd">path!</span><span class="p">(</span><span class="s">"books"</span> <span class="o">/</span> <span class="nb">u64</span><span class="p">)</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nf">delete</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
      <span class="nf">.and_then</span><span class="p">(</span><span class="nn">handlers</span><span class="p">::</span><span class="n">delete_book</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="p">(</span><span class="n">Db</span><span class="p">,),</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Infallible</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nf">any</span><span class="p">()</span><span class="nf">.map</span><span class="p">(</span><span class="k">move</span> <span class="p">||</span> <span class="n">db</span><span class="nf">.clone</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">json_body</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="p">(</span><span class="n">Book</span><span class="p">,),</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="c1">// When accepting a body, we want a JSON body</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nn">body</span><span class="p">::</span><span class="nf">content_length_limit</span><span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span><span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nn">body</span><span class="p">::</span><span class="nf">json</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This might look like a lot of code, but we’re really just redefining similar path structures in composite functions. Let’s take a look at the first function:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/// The routes, combined.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">construct_book_routes</span><span class="p">(</span>
  <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
  <span class="nf">route_get_books</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">())</span>
    <span class="nf">.or</span><span class="p">(</span><span class="nf">route_post_books</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">()))</span>
    <span class="nf">.or</span><span class="p">(</span><span class="nf">route_delete_book</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">()))</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The only responsibility of construct_book_routes is to assemble a list of all the known routes. To make use of this, we must go back into our main function and change the final lines to look something like this:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">warp</span><span class="p">::</span><span class="nf">serve</span><span class="p">(</span><span class="nn">filters</span><span class="p">::</span><span class="nf">construct_book_routes</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
  <span class="nf">.run</span><span class="p">(([</span><span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">3000</span><span class="p">))</span>
  <span class="k">.await</span><span class="p">;</span>
</code></pre></div></div>

<p>Here, we’re telling the warp server what our routes are, and passing along the in-memory DB we’ve created.</p>

<p>Moving on to the next function:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cd">/// GET /books</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">route_get_books</span><span class="p">(</span>
  <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nd">path!</span><span class="p">(</span><span class="s">"books"</span><span class="p">)</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nf">get</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
      <span class="nf">.and_then</span><span class="p">(</span><span class="nn">handlers</span><span class="p">::</span><span class="n">get_books</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>We can ignore the function signature, as that’s largely Warp specific requirements. Instead, let’s look at the function line by line:</p>

<ul>
  <li>
    <p>We’re creating a path called /books</p>
  </li>
  <li>
    <p>This path responds to GET requests</p>
  </li>
  <li>
    <p>It makes use of the database we’re passing it</p>
  </li>
  <li>
    <p>And the actual logic is stored in a to-be-written function called get_books, within the handler’s namespace</p>
  </li>
</ul>

<p>The other two routes define POST and DELETE, which follow a very similar pattern. Let’s move on to the logical implementation:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mod</span> <span class="n">handlers</span> <span class="p">{</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Db</span><span class="p">;</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Book</span><span class="p">;</span>
  <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">convert</span><span class="p">::</span><span class="n">Infallible</span><span class="p">;</span>
  <span class="k">use</span> <span class="nn">warp</span><span class="p">::</span><span class="nn">http</span><span class="p">::</span><span class="n">StatusCode</span><span class="p">;</span>
    
  <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">get_books</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Infallible</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="nf">.lock</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">books</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">books</span><span class="nf">.clone</span><span class="p">();</span>
    <span class="nf">Ok</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nn">reply</span><span class="p">::</span><span class="nf">json</span><span class="p">(</span><span class="o">&amp;</span><span class="n">books</span><span class="p">))</span>
  <span class="p">}</span>
    
  <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">create_book</span><span class="p">(</span>
    <span class="n">book</span><span class="p">:</span> <span class="n">Book</span><span class="p">,</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Infallible</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="nf">.lock</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
    
    <span class="n">books</span><span class="nf">.push</span><span class="p">(</span><span class="n">book</span><span class="p">);</span>
    
    <span class="nf">Ok</span><span class="p">(</span><span class="nn">StatusCode</span><span class="p">::</span><span class="n">CREATED</span><span class="p">)</span>
  <span class="p">}</span>
    
  <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">delete_book</span><span class="p">(</span>
    <span class="n">id</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Infallible</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="nf">.lock</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
    
    <span class="k">let</span> <span class="k">mut</span> <span class="n">iter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="n">books</span><span class="nf">.len</span><span class="p">();</span>
    <span class="n">books</span><span class="nf">.retain</span><span class="p">(|</span><span class="n">_book</span><span class="p">|</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">keep</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">iter</span> <span class="o">==</span> <span class="n">id</span> <span class="p">{</span>
      <span class="n">iter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">keep</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">iter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">keep</span>
  <span class="p">});</span>
    
    <span class="c1">// If the vec is smaller, we found and deleted a book!</span>
    <span class="k">let</span> <span class="n">deleted</span> <span class="o">=</span> <span class="n">books</span><span class="nf">.len</span><span class="p">()</span> <span class="o">!=</span> <span class="n">len</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="n">deleted</span> <span class="p">{</span>
    <span class="c1">// respond with a `204 No Content`, which means successful,</span>
      <span class="nf">Ok</span><span class="p">(</span><span class="nn">StatusCode</span><span class="p">::</span><span class="n">NO_CONTENT</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nf">Ok</span><span class="p">(</span><span class="nn">StatusCode</span><span class="p">::</span><span class="n">NOT_FOUND</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>These routes don’t do much! The GET function prints a list of all the books available; the POST function takes a new book and adds it to the vector; and the DELETE function removes a book based on its index in the vector.</p>

<p>(See the end of the article for the GitHub containing all this code.)</p>

<p>Go ahead and type cargo run in the terminal. Your project will recompile, and when it’s finished, go ahead and enter curl <a href="http://localhost:3000/books">http://localhost:3000/books</a> in another terminal window. You should see a list of your books, and you can note that the other HTTP verbs work, too!</p>

<h2 id="dockerizing-the-rust-server">Dockerizing the Rust server</h2>

<p>Now, we’re ready to take this project and containerize it via <a href="https://www.docker.com">Docker</a>. Docker has evolved over the years to make this process extremely simple. The entire Dockerfile fits in less than a dozen lines of code:</p>

<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Using the Rust official image...</span>
<span class="k">FROM</span><span class="s"> rust:1.60</span>

<span class="c"># Copy the files in your machine to the Docker image...</span>
<span class="k">COPY</span><span class="s"> ./ ./</span>

<span class="c"># Build your program for release...</span>
<span class="k">RUN </span>cargo build <span class="nt">--release</span>

<span class="c"># And run the binary!</span>
<span class="k">CMD</span><span class="s"> ["./target/release/server"]</span>
</code></pre></div></div>

<p>We’ll need to build the Docker container, which we can run with this command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">docker build -t server .
</span></code></pre></div></div>

<p>And finally, we’ll need to start the Docker container, which can be done like this:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">docker run -p 3000:3000 --rm --name server_docker server*
</span></code></pre></div></div>

<p>If you haven’t seen the command for running a Docker container, then it’s worth pointing out several things about the CLI flags. First, we’re exposing port 3000 in our container to our localhost, as 3000. We could change these values if there were port number conflicts between our host machine and the Docker container, however, in this tutorial, that’s not necessary. We’re also naming our Docker as server_docker. This will make it easier to distinguish between logs and other systems’ processes.</p>

<p>After the Docker run command executes, try running the curl command again. You <em>might</em> see the following error:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl: (7) Failed to connect to localhost
</code></pre></div></div>

<p>What does it mean? Well, when Docker launches the container, it assigns it its own IP address. And when the Rust server points to 127.0.0.1, it’s opening a connection to <em>itself</em>, not the broader public world. The fix for this is to change the IP address used in our Rust code, from 127.0.0.1 to 0.0.0.0:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">warp</span><span class="p">::</span><span class="nf">serve</span><span class="p">(</span><span class="nn">filters</span><span class="p">::</span><span class="nf">construct_book_routes</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
  <span class="nf">.run</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">3000</span><span class="p">))</span>
  <span class="k">.await</span><span class="p">;</span>
</code></pre></div></div>

<p>Stop the server by executing the <code class="language-plaintext highlighter-rouge">docker stop</code> command on your terminal. Then, rebuild and rerun the container. If you try the curl command again, you should see the API working as expected!</p>

<h2 id="deploying-to-oracle-cloud-infrastructure-oci">Deploying to Oracle Cloud Infrastructure (OCI)</h2>

<p>At last, we reach the end of our tutorial: hosting our wonderful API online so that it’s available across the internet. This is the easy part!</p>

<p>In order for the OCI to load your Docker image, you will first need to push it to the Oracle Container Registry. You’ll first need to know your Docker container’s image ID to do that. Run the following command to get that information:</p>

<p>docker images</p>

<p>You should see a list like the following:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">REPOSITORY TAG IMAGE ID CREATED SIZE

server latest 8f2569fb8987 25 hours ago 2.83GB
</span></code></pre></div></div>

<p>Take note of that image ID; we will use it when uploading the image to the Oracle Cloud Infrastructure.</p>

<p>Next, follow <a href="https://docs.oracle.com/en/solutions/build-rest-java-application-with-oke/deploy-application-oracle-cloud.html#GUID-ED3E352E-F399-40A3-9530-6E436D99D28C">these steps</a> to learn more about performing the following actions:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">docker login $REGION_KEY.ocir.io</code>, which will log you into the Oracle Cloud Infrastructure Registry region you’re using. Note that <code class="language-plaintext highlighter-rouge">$REGION_KEY</code> is determined by whichever region your account is using; see <a href="https://docs.oracle.com/en-us/iaas/Content/General/Concepts/regions.htm">this list</a> for the key which matches your region.</p>
  </li>
  <li>
    <p>When prompted, your username is in the format of <code class="language-plaintext highlighter-rouge">&lt;tenancy_name&gt;/&lt;username&gt;</code>. The tenancy name can be found under the Tenancy Details section of your administrative profile.</p>
  </li>
  <li>
    <p>Next, type <code class="language-plaintext highlighter-rouge">docker tag $IMAGE_ID $REGION_KEY.ocir.io/$TENANCY_NAME/server:latest</code>, where:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">$IMAGE_ID</code> is the image ID provided by Docker. (In this example, it’s 8f2569fb8987.)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">$REGION_KEY</code> and <code class="language-plaintext highlighter-rouge">$TENANCY_NAME</code> are the same values provided earlier to log in.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Finally, type <code class="language-plaintext highlighter-rouge">docker push $REGION_KEY.ocir.io/$TENANCY_NAME/server:latest</code></p>
  </li>
</ul>

<p>Our server image has now been uploaded onto the Oracle Cloud Infrastructure Container Registry; the final step is to instruct your Oracle Cloud service to pull that image and make use of it. We could do the longer process of <a href="https://docs.oracle.com/en/solutions/build-rest-java-application-with-oke/deploy-your-application-kubernetes1.html#GUID-14EF66C9-3246-4478-B76C-5BF4031A9A8C">setting up Kubernetes</a>, but for such a small app, we can move much quicker if we simply load the image onto the VM directly.</p>

<p>Let’s go ahead and create an OCI Compute instance on which to run our container. Refer to <a href="https://docs.oracle.com/en/learn/lab_compute_instance/#create-a-web-server-on-a-compute-instance-1">the documentation here</a> to learn more about how to do so…be sure to create your Virtual Cloud Network (VCN) with at least one public subnet (hint: the VCN Wizard is a cinch). Be sure to download your SSH private key and take note of your public IP address.</p>

<p>After the instance is provisioned, we can pull our Docker image onto it. <a href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/accessinginstance.htm">Follow these directions to learn how to SSH into your VM instance</a>.</p>

<p>Note that you may need to install Docker on your instance. You can verify whether this is required (or not) by entering the commands from <a href="https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsinstalldocker.htm">this guide</a> into your instance. Simply checking via the docker version command is enough to confirm Docker’s presence:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker version
<span class="go">Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet msg. 

Client: Podman Engine
Version: 4.1.1
API Version: 4.1.1
Go Version: go1.17.12
Built: Thu Aug 4 02:48:00 2022
OS/Arch: linux/arm64                                                           
</span></code></pre></div></div>

<p>With Docker installed, we can pull our image from the Oracle Cloud Infrastructure Registry. First, log in to the OCI Registry using the same credentials as before:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker login <span class="nv">$REGION_KEY</span>.ocir.io
</code></pre></div></div>

<p>Then, pull the image using the tag identifier which was created:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">docker pull $</span>REGION_KEY.ocir.io/<span class="nv">$TENANCY_NAME</span>/server:latest
</code></pre></div></div>

<p>Finally, we will need to make one essential security change, which is opening up a single network port to our machine so that the app is publicly accessible. To do that, you’ll need to <a href="https://docs.oracle.com/en-us/iaas/mysql-database/doc/adding-ingress-rules.html">set up an Ingress rule</a> and point it to port 3000 (HINT: this is done in the Networking configuration, within the VCN previously created). Here’s a final screenshot of what setting up the Ingress rule looks like:</p>

<p><img src="media/image1.jpg" alt="" /></p>

<p>Now that we’ve opened a rule on our network to allow ingress traffic over port 3000, we just need to open port 3000 in our local firewall to allow traffic through; run these two commands on the VM to do so:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-port</span><span class="o">=</span>3000/tcp
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<p>Once that’s finished, we can run the Docker image with the same command we used when running it on our development machine:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">docker run -d -p 3000:3000 --name server_docker $</span>REGION_KEY.ocir.io/<span class="nv">$TENANCY_NAME</span>/server:latest
</code></pre></div></div>

<p>Voila! You can now call <code class="language-plaintext highlighter-rouge">curl http://$PUBLIC_IP_ADDRESS/books</code> and query the API, just like we did locally! Notice that we didn’t need to install Rust or copy over any packages; that was all taken care of by Docker.</p>

<h2 id="learning-more">Learning more</h2>

<p>We’ve only scratched the surface of the features OCI offers for containerized applications. There are many more features catered to modern DevOps practices, including:</p>

<ul>
  <li>Reliable database uptime and migrations</li>
  <li>Observability and monitoring</li>
  <li>Security and app isolation</li>
</ul>

<p>The speed and performance capabilities of Rust are also paired nicely with the availability and response speeds which are provided to apps running on OCI. It’s a win-win for dev, ops, and everything in between.</p>

<p>All the code used in this post can be found in <a href="https://gist.github.com/gjtorikian/8dc63f63291889ad8d95b46ff8e441df">this gist</a>. For more information on how OCI can help you, be sure to check out <a href="https://docs.oracle.com/en-us/iaas/Content/GSG/Concepts/baremetalintro.htm">our docs</a>!</p>]]></content><author><name>Oracle Developers</name></author><category term="clouddev" /><category term="cloudapps" /><category term="open-source" /><category term="devops" /><category term="get-started" /><category term="back-end" /><category term="rust" /><summary type="html"><![CDATA[How to build an API using Rust and host it on Oracle Cloud Infrastructure.]]></summary></entry><entry><title type="html">Building Safe, Fast, and Manageable Applications with Rust and Oracle Cloud Infrastructure</title><link href="https://cool.devo.build/tutorials/rust-on-oci/rust-safe-fast-manageable" rel="alternate" type="text/html" title="Building Safe, Fast, and Manageable Applications with Rust and Oracle Cloud Infrastructure" /><published>2022-12-12T08:00:00+00:00</published><updated>2022-12-12T08:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/rust-on-oci/rust-safe-fast-manageable"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>No question—building and managing modern technology is complex.</p>

<p>Datasets can be massive, expensive to compute, and require highly-performant processes to scale. Data security is critical to business sustainability and is difficult to execute. Architecting systems that can handle modern scale requires intelligent network load balancing and hardware availability.</p>

<p>When you combine all of those challenges (and more!), it becomes a daunting task to imagine how to build an app that simply <em>works</em>. Choosing the tools that solve these issues becomes a crucial question for developers.</p>

<p>In this piece, we’ll make the case that by using <strong>Rust</strong>—a programming language that is fast, secure, memory-safe, and supports complex abstractions—in combination with <strong>OCI</strong>—a Platform-as-a-Service (PaaS) that provides fine-grained control, excellent security measures, and is optimized for performance—developers can have just the right tools to help tame the complexity of building modern software.</p>

<p>We will start with brief backgrounds on Rust and OCI. Then, we’ll dive into several use cases of how Rust and OCI are an excellent solution for modern software applications.</p>

<h2 id="why-rust">Why Rust?</h2>

<p><strong><a href="https://www.rust-lang.org/">Rust</a></strong> is an open source, general-purpose programming language optimized for <strong>safety</strong>, <strong>concurrency</strong>, and <strong>speed</strong>. Rust offers low-level memory access and, as such, can be used for systems programming. It also has a rich set of built-in types and interfaces that allow for code organization and reuse typically associated with higher-level languages.</p>

<p><strong>Safety</strong> - Rust is considered <em>memory safe</em>. This means it protects developers from writing code that results in bugs related to memory access, such as dangling pointers, null pointers, buffer overflows, and so on. These bugs are often exploited as security vulnerabilities. Rust achieves memory safety through features such as a strong type system and the famous <a href="https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html">Borrow Checker</a>.</p>

<p><strong>Concurrency</strong> - Rust has built-in support for concurrent and parallel programming. Developers can easily spawn threads and pass messages between them. A number of abstractions, such as <a href="https://doc.rust-lang.org/std/sync/struct.Arc.html">Atomic Reference Counter</a> (Arc) and <a href="https://www.google.com/url?q=https://tokio.rs&amp;sa=D&amp;source=docs&amp;ust=1666376402644471&amp;usg=AOvVaw0J9DysWwPHFaz8IUfOLRu5">Tokio</a>, protect against many of the classic dangers involved with concurrent programs. Combined with Rust’s memory safety guarantees, this allows the compiler to catch many types of bugs before the code runs. The Rust team calls this “<a href="https://doc.rust-lang.org/book/ch16-00-concurrency.html">Fearless Concurrency</a>.”</p>

<p><strong>Speed</strong> - In terms of performance, Rust is comparable to other lower-level languages like C and C++. Rust is compiled to native code, which results in a low memory footprint. Developers have access to many features that inform the compiler how types will be laid out in memory. Rust’s type system also allows for Zero Cost Abstractions which means that many of the higher-level constructs do not come with a cost at runtime.</p>

<h2 id="why-oracle-cloud-infrastructure-oci">Why Oracle Cloud Infrastructure (OCI)</h2>

<p><a href="https://www.oracle.com/cloud/"><strong>[Oracle Cloud Infrastructure]{.underline}</strong></a> (OCI) is a set of complementary cloud services that enable you to build and run various applications and services in a highly available hosted environment.</p>

<p>OCI provides <strong>high-performance compute capabilities</strong> (as physical hardware instances) and <strong>storage capacity</strong> in a flexible overlay virtual network that is <strong>securely accessible</strong> from your on-premises network. By abstracting away the complexities of safely managing infrastructure, OCI enables businesses to deploy complex, modern applications quickly and for a fraction of the cost of staffing an internal IT team.</p>

<p>Now that we have a little background, let’s look at three services offered on OCI, and explore how Rust works well with these features.</p>

<h2 id="web-and-cloud-native-applications">Web and Cloud Native Applications</h2>

<p>A large percentage of applications today are deployed as cloud-native apps. <strong>OCI provides best-in-class tools for easily building, hosting, and maintaining these web and cloud-native applications</strong>.</p>

<p>When deploying these apps, containerization has become the industry standard. OCI’s <a href="https://docs.oracle.com/en-us/iaas/Content/Registry/Concepts/registryoverview.htm"><strong>[Container Registry]{.underline}</strong></a> allows developers to store container images and then securely access those images at any time. CI/CD pipelines can be designed to build and push images to Container Registry automatically. Containers can then be built from stored images and orchestrated via OCI <a href="https://docs.oracle.com/en-us/iaas/Content/ContEng/Concepts/contengoverview.htm"><strong>[Container Engine for Kubernetes]{.underline}</strong></a>. Once the code is live, OCI offers resource monitoring with its <strong>Events Service</strong>.</p>

<p>Cloud-based applications built on this type of infrastructure can take many forms, such as ecommerce websites, REST APIs, or backend systems managing IoT devices.</p>

<p><strong>Rust</strong></p>

<p>Regardless of the specifics of the business domain, security, usability, performance, and time to market are critical to most apps. As seen above, Rust is designed to handle these challenges, especially with cloud-native applications.</p>

<p><strong>Safety</strong> - Web and cloud-native apps have a much broader attack surface than isolated systems. Not only is the app publicly available, but when building software for the internet, developers typically use frameworks and libraries to solve common problems. This means that the attack surface extends to code that was authored by someone else.</p>

<p>Rust’s memory safety greatly enhances the security of an application and the software it depends on. Fewer vulnerabilities also mean fewer security updates, which means less maintenance and reduced costs.</p>

<p><strong>Concurrency</strong> - Poor app performance leads to higher costs, lower user retention, and the inability to execute expensive computations. This is especially true with cloud-based software that may deal with concurrency issues from socket connections to monetary transactions. Rust’s promise of “Fearless Concurrency” allows developers to take advantage of OCI infrastructure to build correct and performant concurrent software.</p>

<p><strong>Speed</strong> - In addition to the built-in Rust features that increase execution speed, the Rust ecosystem also has several frameworks that encourage rapid development. ORMs exist for data modeling and persistence layer abstraction. Some notable web frameworks that are gaining popularity include <a href="https://nickel-org.github.io/">Nickel.rs</a> or <a href="https://actix.rs/">Actix</a>, both of which can take advantage of projects like <a href="https://diesel.rs/">Diesel</a> for the database abstraction layer.</p>

<h2 id="serverless-functions">Serverless Functions</h2>

<p>Serverless functions are short-running processes that perform discrete tasks, such as processing image data, persisting data to cloud storage, or sending emails. They are usually invoked in response to events and can be chained together to accomplish tasks of arbitrary complexity. When the code is invoked, resources are automatically allocated to achieve configurable performance characteristics. When the code stops running, resources are deallocated. This allows for a cheap and sustainable choice over other alternatives.</p>

<p>OCI supports serverless functions with its <strong><a href="https://docs.oracle.com/en-us/iaas/Content/Functions/Concepts/functionsoverview.htm">Cloud Functions</a>.</strong> Cloud Functions conform to <a href="https://fnproject.io/">Fn Project</a> standards and utilize OCI <strong>Cloud Events</strong> to trigger the invocation of functions. Because Cloud Functions are based on standards from the Fn Project, the code is portable between OCI and other infrastructures that also conform to Fn Project standards.</p>

<p>Cloud Functions has built-in support for several popular programming languages, such as Go, Node, and Ruby. Developers can use the Fn Project CLI to create, configure, and manage serverless functions easily.</p>

<p><strong>Rust</strong></p>

<p><strong>Safety</strong> - Rust’s compile time checks allow developers to write serverless functions with peace of mind knowing that the code is memory safe and free of many types of bugs prior to deployment. Rust also has a built-in test harness, providing even more confidence through the use of unit testing. Test code is not compiled into releases which keeps binaries small.</p>

<p><strong>Speed</strong> - The event-based nature of serverless functions allows for triggering the process on a predefined schedule. One example is sending a notification to an IoT device every minute. Rust’s low memory footprint and emphasis on performance make it an ideal choice for serverless functions, as tasks can be completed quickly and with low resource consumption. This saves money and energy resulting in fast, sustainable, cheap software solutions.</p>

<p>OCI Cloud Functions run inside docker images. Although Cloud Functions do not have direct support for Rust, developers can design and build images conforming to the Fn Project standards and deploy those images to the OCI infrastructure. Rust code can easily be compiled into executable binaries and built into container images for use in Cloud Functions.</p>

<h2 id="high-performance-computing-workloads">High Performance Computing Workloads</h2>

<p>Sometimes it’s necessary to perform computational operations that are extremely resource-intensive. Situations like this require massive processing power, which translates to large numbers of cores working in parallel. Core clusters are connected over a network and often write output to some form of storage. For these types of programs, performance is key.</p>

<p>OCI supports performance-intensive workloads with <a href="https://www.oracle.com/cloud/hpc/"><strong>[High Performance Computing]{.underline}</strong></a> services. Programs have access to potentially tens of thousands of cores connected over a low-latency network. Developers can choose to run code on bare metal or virtual machines. OCI also offers preconfigured virtual machines for ML/AI data science applications with access to large storage volumes.</p>

<p><strong>Rust</strong></p>

<p><strong>Speed</strong> - Again, Rust’s performance characteristics make it a natural fit for these situations. Having low-level access allows developers to finely tune how data structures are laid out in memory and how algorithms interact with resources. When dealing with resource-intensive programming, speed directly translates to reduced energy consumption and costs.</p>

<p><strong>Concurrency</strong> - Access to massive clusters of cores only increases productivity if the code running on the system can efficiently utilize as many cores as possible at any given time. Rust’s support for parallel and concurrent programming has huge advantages here. Rust’s memory safety and “Fearless Concurrency” allow developers to write complex parallel programs confidently and securely.</p>

<h2 id="conclusion">Conclusion</h2>

<p>The complex nature of software development requires developers to choose tools wisely. The correct combination of infrastructure and programming language has huge implications for the success or failure of a software system.</p>

<p>Successful modern software systems need to be secure, performant, and flexible enough to meet the changing needs of the domain in which they operate. OCI’s commitment to, and investment in, fine grain control, security, and optimization is echoed by the Rust team and is reflected in the language and ecosystem. This makes Rust an excellent choice for building complex software on top of OCI.</p>]]></content><author><name>Oracle Developers</name></author><category term="clouddev" /><category term="cloudapps" /><category term="open-source" /><category term="devops" /><category term="get-started" /><category term="back-end" /><category term="rust" /><summary type="html"><![CDATA[How to build safely with modern technology.]]></summary></entry><entry><title type="html">Using Sybl to connect to your Oracle Database</title><link href="https://cool.devo.build/tutorials/rust-on-oci/rust-using-sybl-to-connect-oci" rel="alternate" type="text/html" title="Using Sybl to connect to your Oracle Database" /><published>2022-12-12T08:00:00+00:00</published><updated>2022-12-12T08:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/rust-on-oci/rust-using-sybl-to-connect-oci"><![CDATA[<p>It’s impossible to work in cloud services without hearing about Rust, the system’s programming language from Mozilla. It’s used all over the internet by companies like <a href="https://blog.cloudflare.com/workers-rust-sdk/">Cloudflare</a>, <a href="https://engineering.fb.com/2021/04/29/developer-tools/rust/">Facebook</a>, and <a href="https://discord.com/blog/why-discord-is-switching-from-go-to-rust">Discord</a>. It’s a strongly-typed yet flexible language that emphasizes strict guidelines around memory usage, making it blazing fast and resource lean. The language also focuses on developer productivity, which is evident in their tooling and <a href="https://crates.io/">package ecosystems</a>.</p>

<p>Rust is being used in places where C worked best, due in part to its recognizable syntax. It is also replacing some higher-level languages, like Node and Ruby. In this blog post, we will build a small API microservice using Rust. APIs are generally used in situations where services—a server and a client—must communicate with each other. Our API will represent the backend for an inventory bookstore, where books can be added, fetched, and removed.</p>

<p>This app will be hosted on Oracle Cloud Infrastructure (OCI). OCI enables cloud-native containers to run in highly secure and performant environments that are also fully managed. This makes it a perfect match to host Rust applications, since the platform and the language are well-suited to solve similar problems.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before getting started, you’ll need to install several software packages.</p>

<p>First, you’ll need Rust. Regardless of your operating system, <a href="https://rustup.rs">the Rustup script</a> is guaranteed to work and installs all the necessary tools you need to start building a Rust application. You’ll also need to install <a href="https://www.docker.com">Docker</a> to test the app containerization locally.</p>

<p>In order to deploy the app online, you’ll also need <a href="https://www.oracle.com/cloud/free/?source=CloudFree_CTA1_Default&amp;intcmp=CloudFree_CTA1_Default">a free OCI account</a>.</p>

<h2 id="getting-started-with-the-rust-code">Getting started with the Rust code</h2>

<p>As with many programming languages, Rust comes with its own package management system called <a href="https://crates.io">Crates</a>. To start building our app, we will want an HTTP web framework to do the heavy lifting for us. There are many to choose from, but we’ll use <a href="https://github.com/seanmonstar/warp">warp</a>, as it’s both popular and performant. Just as Node uses package.json to manage packages, Rust uses Cargo.toml.</p>

<p>Create a new directory within which you can start building this project, and create a file named Cargo.toml in it. Paste these lines into that file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [package]
  name = "server"
  version = "0.1.0"
  license = "MIT"
  edition = "2018"
  
  [dependencies]
  tokio = { version = "1", features = ["full"] }
  warp = "0.3"
  serde = { version = "1", features = ["derive"]}
  serde_json = "1.0"

</code></pre></div></div>

<p>Here, we’re defining the general metadata of our package. We’re specifying that we want to create a binary executable named server; we also have a list of dependencies that our project needs, including warp.</p>

<p>Next, create a directory called src, and a directory called bin within that. Then, create a file called server.rs, and paste these lines into it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  #![deny(warnings)]
  use warp::Filter;
  
  #[tokio::main]
  async fn main() {
  // Match any request and return hello world!
  let routes = warp::any().map(|| "Hello, World!");
  
  warp::serve(routes).run(([127, 0, 0, 1], 3000)).await;
  }

</code></pre></div></div>

<p>We’ve defined a very basic Warp server, which will run on <a href="http://127.0.0.1:3000">http://127.0.0.1:3000</a>. When a user visits that page, they’ll see a greeting. Go ahead and type <code class="language-plaintext highlighter-rouge">cargo run</code> on the terminal. Cargo will download all the dependencies you defined, then it’ll compile them together with the server.rs file to create an executable. (All of that in just one command!) When it’s finished, you’ll see the following message:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ❯ cargo run
  Finished dev [unoptimized + debuginfo] target(s) in 0.06s
  Running `target/debug/server`

</code></pre></div></div>

<p>Navigate your browser window to <a href="http://127.0.0.1:3000">http://127.0.0.1:3000</a>, which should show the greeting, thus confirming that the initial project setup has worked!</p>

<h2 id="setting-up-an-api">Setting up an API</h2>

<p>Now that we have verified that our server runs correctly, it’s time to build a more proper API. We want our API to get a list of books, add a new book, and remove a book.</p>

<p>In a future blog, we will integrate with a backend database for storing and querying the data. To keep things simple in this tutorial, we’ll just fake the data store by defining an array to store all of our books.</p>

<p>Let’s start by defining the structure of a Book. Rust has the concept of structs, which are akin to lightweight classes. Here’s an example of what our Book class would look like:</p>

<p>(All the code below replaces the code in the server.rs file.)</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">serde</span><span class="p">::{</span><span class="n">Deserialize</span><span class="p">,</span> <span class="n">Serialize</span><span class="p">};</span>

<span class="nd">#[derive(Clone,</span> <span class="nd">Serialize,</span> <span class="nd">Deserialize)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">Book</span> <span class="p">{</span>
  <span class="n">title</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="n">author</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="n">year</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can then modify our main function to immediately set up a basic catalog of books that follow this structure. We will use a vector (which is like an expandable array), and store the list in memory:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">sync</span><span class="p">::</span><span class="nb">Arc</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">tokio</span><span class="p">::</span><span class="nn">sync</span><span class="p">::</span><span class="n">Mutex</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">type</span> <span class="n">Db</span> <span class="o">=</span> <span class="nb">Arc</span><span class="o">&lt;</span><span class="n">Mutex</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;&gt;&gt;</span><span class="p">;</span>

<span class="nd">#[tokio::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">let</span> <span class="k">mut</span> <span class="n">book_catalog</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"The Hitchhiker's Guide to the Galaxy"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1979</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"The Restaurant at the End of the Universe"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1980</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"Life, the Universe and Everything"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1982</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"So Long, and Thanks for All the Fish"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1984</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="n">book_catalog</span><span class="nf">.push</span><span class="p">(</span><span class="n">Book</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s">"Mostly Harmless"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">author</span><span class="p">:</span> <span class="s">"Douglas Adams"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">1992</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="k">let</span> <span class="n">db</span> <span class="o">=</span> <span class="nn">Arc</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nn">Mutex</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">book_catalog</span><span class="p">));</span>
</code></pre></div></div>

<p>So far, so good? Right on!</p>

<p>The next task is to add routes to this API. There are a number of patterns to implement this, but the one suggested by Warp takes a two-pronged approach: First, the routes are defined, and then, the implementation of those routes is defined. This way, the implementation can change, but the route information can be considered static and stable.</p>

<p>Let’s go ahead and define these routes. We’ll drop the code first, and then provide a closer examination:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mod</span> <span class="n">filters</span> <span class="p">{</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Db</span><span class="p">;</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Book</span><span class="p">;</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">handlers</span><span class="p">;</span>
  <span class="k">use</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Filter</span><span class="p">;</span>
  <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">convert</span><span class="p">::</span><span class="n">Infallible</span><span class="p">;</span>

  <span class="cd">/// The routes, combined.</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">construct_book_routes</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nf">route_get_books</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">())</span>
      <span class="nf">.or</span><span class="p">(</span><span class="nf">route_post_books</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">()))</span>
      <span class="nf">.or</span><span class="p">(</span><span class="nf">route_delete_book</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">()))</span>
  <span class="p">}</span>

  <span class="cd">/// GET /books</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">route_get_books</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nd">path!</span><span class="p">(</span><span class="s">"books"</span><span class="p">)</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nf">get</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
      <span class="nf">.and_then</span><span class="p">(</span><span class="nn">handlers</span><span class="p">::</span><span class="n">get_books</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="cd">/// POST /books with JSON body</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">route_post_books</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nd">path!</span><span class="p">(</span><span class="s">"books"</span><span class="p">)</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nf">post</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">json_body</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
      <span class="nf">.and_then</span><span class="p">(</span><span class="nn">handlers</span><span class="p">::</span><span class="n">create_book</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="cd">/// DELETE /books/:id</span>
  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">route_delete_book</span><span class="p">(</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nd">path!</span><span class="p">(</span><span class="s">"books"</span> <span class="o">/</span> <span class="nb">u64</span><span class="p">)</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nf">delete</span><span class="p">())</span>
      <span class="nf">.and</span><span class="p">(</span><span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
      <span class="nf">.and_then</span><span class="p">(</span><span class="nn">handlers</span><span class="p">::</span><span class="n">delete_book</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="p">(</span><span class="n">Db</span><span class="p">,),</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Infallible</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nf">any</span><span class="p">()</span><span class="nf">.map</span><span class="p">(</span><span class="k">move</span> <span class="p">||</span> <span class="n">db</span><span class="nf">.clone</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="k">pub</span> <span class="k">fn</span> <span class="nf">json_body</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="p">(</span><span class="n">Book</span><span class="p">,),</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
    <span class="c1">// When accepting a body, we want a JSON body</span>
    <span class="nn">warp</span><span class="p">::</span><span class="nn">body</span><span class="p">::</span><span class="nf">content_length_limit</span><span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span><span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nn">body</span><span class="p">::</span><span class="nf">json</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This might look like a lot of code, but we’re really just redefining similar path structures in composite functions. Let’s take a look at the first function:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/// The routes, combined.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">construct_book_routes</span><span class="p">(</span>
  <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
  <span class="nf">route_get_books</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">())</span>
    <span class="nf">.or</span><span class="p">(</span><span class="nf">route_post_books</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">()))</span>
    <span class="nf">.or</span><span class="p">(</span><span class="nf">route_delete_book</span><span class="p">(</span><span class="n">db</span><span class="nf">.clone</span><span class="p">()))</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The only responsibility of construct_book_routes is to assemble a list of all the known routes. To make use of this, we must go back into our main function and change the final lines to look something like this:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">warp</span><span class="p">::</span><span class="nf">serve</span><span class="p">(</span><span class="nn">filters</span><span class="p">::</span><span class="nf">construct_book_routes</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
  <span class="nf">.run</span><span class="p">(([</span><span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">3000</span><span class="p">))</span>
  <span class="k">.await</span><span class="p">;</span>
</code></pre></div></div>

<p>Here, we’re telling the warp server what our routes are, and passing along the in-memory DB we’ve created.</p>

<p>Moving on to the next function:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/// GET /books</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">route_get_books</span><span class="p">(</span>
  <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Filter</span><span class="o">&lt;</span><span class="n">Extract</span> <span class="o">=</span> <span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Error</span> <span class="o">=</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Rejection</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Clone</span> <span class="p">{</span>
  <span class="nn">warp</span><span class="p">::</span><span class="nd">path!</span><span class="p">(</span><span class="s">"books"</span><span class="p">)</span>
    <span class="nf">.and</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nf">get</span><span class="p">())</span>
    <span class="nf">.and</span><span class="p">(</span><span class="nf">with_db</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
    <span class="nf">.and_then</span><span class="p">(</span><span class="nn">handlers</span><span class="p">::</span><span class="n">get_books</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can ignore the function signature, as that’s largely Warp specific requirements. Instead, let’s look at the function line by line:</p>

<ul>
  <li>We’re creating a path called /books</li>
  <li>This path responds to GET requests</li>
  <li>It makes use of the database we’re passing it</li>
  <li>And the actual logic is stored in a to-be-written function called get_books, within the handler’s namespace</li>
</ul>

<p>The other two routes define POST and DELETE, which follow a very similar pattern. Let’s move on to the logical implementation:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mod</span> <span class="n">handlers</span> <span class="p">{</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Db</span><span class="p">;</span>
  <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Book</span><span class="p">;</span>
  <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">convert</span><span class="p">::</span><span class="n">Infallible</span><span class="p">;</span>
  <span class="k">use</span> <span class="nn">warp</span><span class="p">::</span><span class="nn">http</span><span class="p">::</span><span class="n">StatusCode</span><span class="p">;</span>
  
  <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">get_books</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Infallible</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="nf">.lock</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">books</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">books</span><span class="nf">.clone</span><span class="p">();</span>
    <span class="nf">Ok</span><span class="p">(</span><span class="nn">warp</span><span class="p">::</span><span class="nn">reply</span><span class="p">::</span><span class="nf">json</span><span class="p">(</span><span class="o">&amp;</span><span class="n">books</span><span class="p">))</span>
  <span class="p">}</span>
  
  <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">create_book</span><span class="p">(</span>
    <span class="n">book</span><span class="p">:</span> <span class="n">Book</span><span class="p">,</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span><span class="p">,</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Infallible</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="nf">.lock</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
  
    <span class="n">books</span><span class="nf">.push</span><span class="p">(</span><span class="n">book</span><span class="p">);</span>
  
    <span class="nf">Ok</span><span class="p">(</span><span class="nn">StatusCode</span><span class="p">::</span><span class="n">CREATED</span><span class="p">)</span>
  <span class="p">}</span>
  
  <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">delete_book</span><span class="p">(</span>
    <span class="n">id</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Db</span>
  <span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">impl</span> <span class="nn">warp</span><span class="p">::</span><span class="n">Reply</span><span class="p">,</span> <span class="n">Infallible</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="nf">.lock</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
  
    <span class="k">let</span> <span class="k">mut</span> <span class="n">iter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="n">books</span><span class="nf">.len</span><span class="p">();</span>
    <span class="n">books</span><span class="nf">.retain</span><span class="p">(|</span><span class="n">_book</span><span class="p">|</span> <span class="p">{</span>
      <span class="k">let</span> <span class="k">mut</span> <span class="n">keep</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="n">iter</span> <span class="o">==</span> <span class="n">id</span> <span class="p">{</span>
        <span class="n">iter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">iter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">keep</span>
    <span class="p">});</span>
  
    <span class="c1">// If the vec is smaller, we found and deleted a book!</span>
    <span class="k">let</span> <span class="n">deleted</span> <span class="o">=</span> <span class="n">books</span><span class="nf">.len</span><span class="p">()</span> <span class="o">!=</span> <span class="n">len</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="n">deleted</span> <span class="p">{</span>
      <span class="c1">// respond with a `204 No Content`, which means successful,</span>
      <span class="nf">Ok</span><span class="p">(</span><span class="nn">StatusCode</span><span class="p">::</span><span class="n">NO_CONTENT</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nf">Ok</span><span class="p">(</span><span class="nn">StatusCode</span><span class="p">::</span><span class="n">NOT_FOUND</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>These routes don’t do much! The GET function prints a list of all the books available; the POST function takes a new book and adds it to the vector; and the DELETE function removes a book based on its index in the vector.</p>

<p>(See the end of the article for the GitHub containing all this code.)</p>

<p>Go ahead and type cargo run in the terminal. Your project will recompile, and when it’s finished, go ahead and enter curl <a href="http://localhost:3000/books">http://localhost:3000/books</a> in another terminal window. You should see a list of your books, and you can note that the other HTTP verbs work, too!</p>

<h2 id="dockerizing-the-rust-server">Dockerizing the Rust server</h2>

<p>Now, we’re ready to take this project and containerize it via <a href="https://www.docker.com">Docker</a>. Docker has evolved over the years to make this process extremely simple. The entire Dockerfile fits in less than a dozen lines of code:</p>

<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Using the Rust official image...</span>
<span class="k">FROM</span><span class="s"> rust:1.60</span>

<span class="c"># Copy the files in your machine to the Docker image...</span>
<span class="k">COPY</span><span class="s"> ./ ./</span>

<span class="c"># Build your program for release...</span>
<span class="k">RUN </span>cargo build <span class="nt">--release</span>

<span class="c"># And run the binary!</span>
<span class="k">CMD</span><span class="s"> ["./target/release/server"]</span>
</code></pre></div></div>

<p>We’ll need to build the Docker container, which we can run with this command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker build <span class="nt">-t</span> server <span class="nb">.</span>
</code></pre></div></div>

<p>And finally, we’ll need to start the Docker container, which can be done like this:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">-p</span> 3000:3000 <span class="nt">--rm</span> <span class="nt">--name</span> server_docker server
</code></pre></div></div>

<p>If you haven’t seen the command for running a Docker container, then it’s worth pointing out several things about the CLI flags. First, we’re exposing port 3000 in our container to our localhost, as 3000. We could change these values if there were port number conflicts between our host machine and the Docker container, however, in this tutorial, that’s not necessary. We’re also naming our Docker as server_docker. This will make it easier to distinguish between logs and other systems’ processes.</p>

<p>After the Docker run command executes, try running the curl command again. You <em>might</em> see the following error:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl: (7) Failed to connect to localhost
</code></pre></div></div>

<p>What does it mean? Well, when Docker launches the container, it assigns it its own IP address. And when the Rust server points to 127.0.0.1, it’s opening a connection to <em>itself</em>, not the broader public world. The fix for this is to change the IP address used in our Rust code, from 127.0.0.1 to 0.0.0.0:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">warp</span><span class="p">::</span><span class="nf">serve</span><span class="p">(</span><span class="nn">filters</span><span class="p">::</span><span class="nf">construct_book_routes</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
  <span class="nf">.run</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">3000</span><span class="p">))</span>
  <span class="k">.await</span><span class="p">;</span>
</code></pre></div></div>

<p>Stop the server by executing the docker stop command on your terminal. Then, rebuild and rerun the container. If you try the curl command again, you should see the API working as expected!</p>

<h2 id="deploying-to-oracle-cloud-infrastructure-oci">Deploying to Oracle Cloud Infrastructure (OCI)</h2>

<p>At last, we reach the end of our tutorial: hosting our wonderful API online so that it’s available across the internet. This is the easy part!</p>

<p>In order for the OCI to load your Docker image, you will first need to push it to the Oracle Container Registry. You’ll first need to know your Docker container’s image ID to do that. Run the following command to get that information:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker images
</code></pre></div></div>

<p>You should see a list like the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REPOSITORY TAG IMAGE ID CREATED SIZE

server latest 8f2569fb8987 25 hours ago 2.83GB
</code></pre></div></div>

<p>Take note of that image ID; we will use it when uploading the image to the Oracle Cloud Infrastructure.</p>

<p>Next, follow <a href="https://docs.oracle.com/en/solutions/build-rest-java-application-with-oke/deploy-application-oracle-cloud.html#GUID-ED3E352E-F399-40A3-9530-6E436D99D28C">these steps</a> to learn more about performing the following actions:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">docker login $REGION_KEY.ocir.io</code>, which will log you into the Oracle Cloud Infrastructure Registry region you’re using. Note that <code class="language-plaintext highlighter-rouge">$REGION_KEY</code> is determined by whichever region your account is using; see <a href="https://docs.oracle.com/en-us/iaas/Content/General/Concepts/regions.htm">this list</a> for the key which matches your region.</li>
  <li>
    <p>When prompted, your username is in the format of <code class="language-plaintext highlighter-rouge">&lt;tenancy_name&gt;/&lt;username&gt;</code>. The tenancy name can be found under the Tenancy Details section of your administrative profile.</p>
  </li>
  <li>
    <p>Next, type <code class="language-plaintext highlighter-rouge">docker tag $IMAGE_ID $REGION_KEY.ocir.io/$TENANCY_NAME/server:latest</code>, where:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">$IMAGE_ID</code> is the image ID provided by Docker. (In this example, it’s <code class="language-plaintext highlighter-rouge">8f2569fb8987</code>.)</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">$REGION_KEY</code> and <code class="language-plaintext highlighter-rouge">$TENANCY_NAME</code> are the same values provided earlier to log in.</p>
      </li>
    </ul>
  </li>
  <li>Finally, type <code class="language-plaintext highlighter-rouge">docker push $REGION_KEY.ocir.io/$TENANCY_NAME/server:latest</code></li>
</ul>

<p>Our server image has now been uploaded onto the Oracle Cloud Infrastructure Container Registry; the final step is to instruct your Oracle Cloud service to pull that image and make use of it. We could do the longer process of <a href="https://docs.oracle.com/en/solutions/build-rest-java-application-with-oke/deploy-your-application-kubernetes1.html#GUID-14EF66C9-3246-4478-B76C-5BF4031A9A8C">setting up Kubernetes</a>, but for such a small app, we can move much quicker if we simply load the image onto the VM directly.</p>

<p>Let’s go ahead and create an OCI Compute instance on which to run our container. Refer to <a href="https://docs.oracle.com/en/learn/lab_compute_instance/#create-a-web-server-on-a-compute-instance-1">the documentation here</a> to learn more about how to do so; be sure to create your Virtual Cloud Network (VCN) with at least one public subnet (hint: the VCN Wizard is a cinch). Be sure to download your SSH private key and take note of your public IP address.</p>

<p>After the instance is provisioned, we can pull our Docker image onto it. <a href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/accessinginstance.htm">Follow these directions to learn how to SSH into your VM instance</a>.</p>

<p>Note that you may need to install Docker on your instance. You can verify whether this is required (or not) by entering the commands from <a href="https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsinstalldocker.htm">this guide</a> into your instance. Simply checking via the docker version command is enough to confirm Docker’s presence:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker version
<span class="go">
Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet msg. 

Client: Podman Engine
Version: 4.1.1
API Version: 4.1.1
Go Version: go1.17.12
Built: Thu Aug 4 02:48:00 2022
OS/Arch: linux/arm64
</span></code></pre></div></div>

<p>With Docker installed, we can pull our image from the Oracle Cloud Infrastructure Registry. First, log in to the OCI Registry using the same credentials as before:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">docker login $</span>REGION_KEY.ocir.io
</code></pre></div></div>

<p>Then, pull the image using the tag identifier which was created:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">docker pull $</span>REGION_KEY.ocir.io/<span class="nv">$TENANCY_NAME</span>/server:latest
</code></pre></div></div>

<p>Finally, we will need to make one essential security change, which is opening up a single network port to our machine so that the app is publicly accessible. To do that, you’ll need to <a href="https://docs.oracle.com/en-us/iaas/mysql-database/doc/adding-ingress-rules.html">set up an Ingress rule</a> and point it to port 3000 (HINT: this is done in the Networking configuration, within the VCN previously created). Here’s a final screenshot of what setting up the Ingress rule looks like:</p>

<picture class="">
                <source srcset="media/rId43.jpg 1x" />
                <img loading="lazy" src="media/rId43.jpg" data-original="media/rId43.jpg" />
            </picture>

<p>Now that we’ve opened a rule on our network to allow ingress traffic over port 3000, we just need to open port 3000 in our local firewall to allow traffic through; run these two commands on the VM to do so:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-port</span><span class="o">=</span>3000/tcp
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<p>Once that’s finished, we can run the Docker image with the same command we used when running it on our development machine:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">-d</span> <span class="nt">-p</span> 3000:3000 <span class="nt">--name</span> server_docker <span class="nv">$REGION_KEY</span>.ocir.io/<span class="nv">$TENANCY_NAME</span>/server:latest
</code></pre></div></div>

<p>Voila! You can now call <code class="language-plaintext highlighter-rouge">curl http://$PUBLIC_IP_ADDRESS/books</code> and query the API, just like we did locally! Notice that we didn’t need to install Rust or copy over any packages; that was all taken care of by Docker.</p>

<h2 id="learning-more">Learning more</h2>

<p>We’ve only scratched the surface of the features OCI offers for containerized applications. There are many more features catered to modern DevOps practices, including:</p>

<ul>
  <li>Reliable database uptime and migrations</li>
  <li>Observability and monitoring</li>
  <li>Security and app isolation</li>
</ul>

<p>The speed and performance capabilities of Rust are also paired nicely with the availability and response speeds which are provided to apps running on OCI. It’s a win-win for dev, ops, and everything in between.</p>

<p>All the code used in this post can be found in <a href="https://gist.github.com/gjtorikian/8dc63f63291889ad8d95b46ff8e441df">this gist</a>. For more information on how OCI can help you, be sure to check out <a href="https://docs.oracle.com/en-us/iaas/Content/GSG/Concepts/baremetalintro.htm">our docs</a>!</p>]]></content><author><name>Oracle Developers</name></author><category term="clouddev" /><category term="cloudapps" /><category term="open-source" /><category term="devops" /><category term="get-started" /><category term="back-end" /><category term="rust" /><summary type="html"><![CDATA[How to build safely with modern technology.]]></summary></entry><entry><title type="html">Rust on OCI</title><link href="https://cool.devo.build/tutorials/rust-on-oci/" rel="alternate" type="text/html" title="Rust on OCI" /><published>2022-12-12T06:00:00+00:00</published><updated>2022-12-12T06:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/rust-on-oci/"><![CDATA[]]></content><author><name>{&quot;name&quot;=&gt;nil}</name></author><category term="open-source" /><category term="devops" /><category term="get-started" /><category term="rust" /><summary type="html"><![CDATA[Use Rust to implement applications on Oracle Cloud Infrastructure]]></summary></entry><entry><title type="html">Connecting To and Managing HeatWave on AWS</title><link href="https://cool.devo.build/tutorials/connecting-managing-heatwave-aws-devrel0622" rel="alternate" type="text/html" title="Connecting To and Managing HeatWave on AWS" /><published>2022-06-16T17:00:00+00:00</published><updated>2022-06-16T17:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/connecting-managing-heatwave-aws-devrel0622"><![CDATA[<p>It’s a multi-cloud world today, and that’s why MySQL HeatWave for Amazon Web Service gives you a massively parallel, high performance, in-memory query accelerator for the MySQL Database Service as a fully managed service, developed and supported by the MySQL team in Oracle. This accelerates MySQL performance by orders of magnitude for combined analytics and transactional workloads (OLAP and OLTP).</p>

<picture class="">
                <source srcset="assets/networkdiagram-hwaws-oci-devrel0622a.png 1x" />
                <img loading="lazy" src="assets/networkdiagram-hwaws-oci-devrel0622a.png" data-original="assets/networkdiagram-hwaws-oci-devrel0622a.png" />
            </picture>

<p>Oracle designed this so developers can focus on the important things, like managing data, creating schemas, and providing highly-available applications. Oracle automates tasks such as backup, recovery, and database and operating system patching.</p>

<p>If you’ve never heard of HeatWave, think of it as a database query accelerator with boost buttons. One of the incredible things about Oracle MySQL HeatWave is the ability to <a href="https://www.oracle.com/mysql/heatwave/">run analytics</a> directly against your existing transactional data, so there’s no need to shuffle that data off to a separate system when you need to perform massively parallel analysis.</p>

<p>Let’s get started!</p>

<p>MySQL HeatWave on AWS resides in an Oracle-managed tenancy on AWS. You can access it from the browser-based HeatWave Console or from a MySQL client or application. For this article, we’ll just dip our toe in by signing in, provisioning the service, and seeing an overview of what the HeatWave Console offers.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>The MySQL HeatWave Console supports browser platforms supported by Oracle Jet, such as the following browsers and versions:</p>

<ul>
  <li>Google Chrome 69 or later</li>
  <li>Safari 12.1 or later</li>
  <li>Firefox 62 or later</li>
  <li>The Console does not support Firefox Private Browsing.</li>
</ul>

<p>You’ll also need an AWS account, optionally an OCI account as well.</p>

<p>Plus, you’ll need a DB System somewhere to connect to the HeatWave instance (this could be a HeatWave cluster in an OCI tenancy, for example).</p>

<h2 id="signing-up">Signing Up</h2>

<p>To sign up for MySQL HeatWave on AWS (if you don’t have an Oracle account):</p>

<ol>
  <li>Navigate your browser to <a href="http://cloud.mysql.com/">http://cloud.mysql.com/</a>. You are taken to the MySQL HeatWave on AWS welcome page.</li>
  <li>Click Sign Up. A field is displayed for entering your email address.</li>
  <li>Enter your email address and click Continue.
    <picture class="">
             <source srcset="assets/welcome2-mysqlhw-signup-actname-devrel0622a.png 1x" />
             <img loading="lazy" src="assets/welcome2-mysqlhw-signup-actname-devrel0622a.png" data-original="assets/welcome2-mysqlhw-signup-actname-devrel0622a.png" />
         </picture>
    <p>You are directed to an Account Information page for creating an Oracle Cloud account, which is required to use MySQL HeatWave on AWS.</p>
    <blockquote class="notice">
      <p><strong>NOTE:</strong> Do NOT change your Oracle Cloud Account name after provisioning the MySQL HeatWave on AWS service, as it can cause a loss of access to the MySQL HeatWave on AWS service, requiring Support assistance.</p>
    </blockquote>
  </li>
  <li>Enter the required information and click Verify my email. A verification email is sent to the specified address. This may take a minute!</li>
  <li>In the verification email, click on the verification link.
 You are directed to a page for verifying the email address and providing initial account information. Follow the prompts. After providing the initial account information, you’ll go to a Get Started page in the Oracle Cloud Infrastructure (OCI) Console, which includes an Enable MySQL HeatWave on AWS link in the Quickstarts section of the page.</li>
  <li>Click Enable MySQL HeatWave on AWS.<br />
You are directed to a MySQL HeatWave on AWS Administration page where you are presented with a dialog that guides you through the setup process.
    <picture class="">
             <source srcset="assets/hwaws-quickstart-enablehwaws-devrel0622a.png 1x" />
             <img loading="lazy" src="assets/hwaws-quickstart-enablehwaws-devrel0622a.png" data-original="assets/hwaws-quickstart-enablehwaws-devrel0622a.png" />
         </picture>
  </li>
  <li>A paid account is required to use MySQL HeatWave on AWS. Follow the prompts to complete the account upgrade process. You will be prompted to select an account type and payment method. When the upgrade process is complete, you are directed to the OCI Console.
    <picture class="">
             <source srcset="assets/upgd-awshw-account-reqscrn-devrel0622.png 1x" />
             <img loading="lazy" src="assets/upgd-awshw-account-reqscrn-devrel0622.png" data-original="assets/upgd-awshw-account-reqscrn-devrel0622.png" />
         </picture>
  </li>
  <li>From the OCI Console navigation menu, select Databases. MySQL HeatWave on AWS appears on the Home tab under the Featured label.</li>
  <li>Under MySQL HeatWave on AWS, click Administration. You are returned to the setup dialog.</li>
  <li>
    <p>Click Provision to provision MySQL HeatWave on AWS.</p>

    <p>After the provisioning operation is completed, a message appears stating that MySQL HeatWave on AWS is ready and you are presented with options to open the MySQL HeatWave console, set up users, and view billing information.</p>
  </li>
</ol>

<h3 id="for-those-with-an-existing-oracle-account">For those with an existing Oracle account</h3>

<p>MySQL HeatWave on AWS requires a subscription to the US East (Ashburn) region on OCI. MySQL HeatWave on AWS is integrated with OCI in the US East (Ashburn) region for identity and access management and billing. You are billed for the MySQL HeatWave on AWS Service in the US East (Ashburn) region.</p>

<ol>
  <li>Navigate your browser to <a href="http://cloud.mysql.com/">http://cloud.mysql.com/</a>.<br />
You are taken to the MySQL HeatWave on AWS welcome page.</li>
  <li>Enter your Oracle Cloud Account name and click Continue.<br />
You are directed to a Get Started page in the Oracle Cloud Infrastructure (OCI) Console, which includes an Enable MySQL HeatWave on AWS link in the Quickstarts section of the page.</li>
  <li>
    <p>Click Enable MySQL HeatWave on AWS.<br />
You are directed to a MySQL HeatWave on AWS Administration page where you are presented with a dialog that guides you through the setup process.</p>

    <blockquote class="warn">
      <p><strong>IMPORTANT:</strong> A paid account is required to use MySQL HeatWave on AWS. If you do not have a paid account, follow the prompts to compete the account upgrade process. You will be prompted to select an account type and payment method. When the upgrade process is complete, you are directed to the OCI Console.</p>
    </blockquote>
  </li>
  <li>From the OCI Console navigation menu, select Databases.<br />
MySQL HeatWave on AWS appears on the Home tab under the Featured label.</li>
  <li>Under MySQL HeatWave on AWS, click Administration.<br />
You’ll go back to the setup dialog.</li>
  <li>Click Provision to provision MySQL HeatWave on AWS.
    <picture class="">
             <source srcset="assets/provision-requpg-hwaws-setup-devrel0622a.png 1x" />
             <img loading="lazy" src="assets/provision-requpg-hwaws-setup-devrel0622a.png" data-original="assets/provision-requpg-hwaws-setup-devrel0622a.png" />
         </picture>

    <p>After the provisioning operation is completed, a message appears stating that MySQL HeatWave on AWS is ready and you are presented with options to open the MySQL HeatWave console, set up users, and view billing information.</p>

    <picture class="">
             <source srcset="assets/congrats-mysqlhwaws-openconsol-devrel0622a.png 1x" />
             <img loading="lazy" src="assets/congrats-mysqlhwaws-openconsol-devrel0622a.png" data-original="assets/congrats-mysqlhwaws-openconsol-devrel0622a.png" />
         </picture>
  </li>
</ol>

<h2 id="signing-in">Signing In</h2>

<p>To sign in to MySQL HeatWave on AWS, you must have:</p>

<ul>
  <li>Your Oracle Cloud Account name.<br />
This is the Cloud Account name you chose during account signup or that was provided to you by an Account Administrator. In either case, you can find your Cloud Account name in your Oracle Cloud Account welcome email.</li>
  <li>Your Cloud Account user name and password.</li>
</ul>

<p>Let’s get started!</p>

<ol>
  <li>Point your browser to <a href="http://cloud.mysql.com/">http://cloud.mysql.com/</a><br />
You are taken to the MySQL HeatWave on AWS welcome page. You’re familiar by now with this screen.</li>
  <li>Enter your Cloud Account name.</li>
  <li>Click Continue.
You are directed to the Oracle Cloud Account Sign In dialog.</li>
  <li>
    <p>Enter your user name and password and click Sign In.</p>

    <p>Once your user name and password are authenticated, you are directed to the HeatWave Console. Eventually you’ll need to create users and groups (for various levels of access control), and luckily you can access the Oracle Identity Cloud Service from the MySQL HEatWave on AWS Console:</p>

    <ol>
      <li>Sign into the HeatWave Console as an Account Administrator.</li>
      <li>From the profile menu, select Administration.<br />
You are directed to the MySQL HeatWave on AWS Administration page in the OCI Console.</li>
      <li>
        <p>Select Identity Service.</p>

        <p>This will take you to the Identity section in the OCI Account Center.</p>

        <picture class="">
          <source srcset="assets/mysqlhw-awsconsole-2view-signin-devrel0622a.png 1x" />
          <img loading="lazy" src="assets/mysqlhw-awsconsole-2view-signin-devrel0622a.png" data-original="assets/mysqlhw-awsconsole-2view-signin-devrel0622a.png" />
      </picture>
      </li>
    </ol>
  </li>
</ol>

<h2 id="whats-next">What’s Next?</h2>

<p>From here, you can log into the MySQL HeatWave on AWS Console and create a MySQL DB System, manage them, see HeatWave Clusters, Workspaces (where you can create and run queries), and Performance (analytics) to see how efficient HeatWave is.</p>

<picture class="">
                <source srcset="assets/1-mysql-heatwave-on-aws-console-devrel-fy2361022.png 1x" />
                <img loading="lazy" src="assets/1-mysql-heatwave-on-aws-console-devrel-fy2361022.png" data-original="assets/1-mysql-heatwave-on-aws-console-devrel-fy2361022.png" />
            </picture>

<h3 id="connecting-to-a-db-system-in-workspaces">Connecting to a DB System in Workspaces</h3>

<p>By now you’ve got MySQL HeatWave on AWS provisioned, and you want to connect it to a DB System somewhere. We do this in the Workspaces tab in the console.</p>

<p>A Connection Information dialog will appear, and you choose a DB System from the drop-down, enter the proper username/password combo, and click Connect.</p>

<h3 id="managing-heatwave-cluster-data">Managing HeatWave Cluster Data</h3>

<p>Also in the Workspaces tab, we can use the Console to load or unload data from a HeatWave cluster. Here’s how:</p>

<ol>
  <li>In the DB System workspace, expand the Manage Data in HeatWave pane.</li>
  <li>Select the databases and tables that you want to load or unload. Databases are selected in the Databases pane. When a database is selected, the tables from the selected database appear in the Tables from selected databases pane.</li>
  <li>
    <p>There’s lots to see there but we’re interested in selecting the tables we want to load or unload, so click Load into HeatWave or Unload from HeatWave.</p>

    <p>If you’re loading tables, the MySQL Auto Parallel Load tables into Heatwave dialog appears, providing a summary of the load operation about to happen.</p>
  </li>
  <li>
    <p>Click Load Tables to start the parallel load operation.</p>

    <p>To stop a load or unload operation, click Stop Load/Unload.</p>
  </li>
</ol>

<blockquote class="notice">
  <p><strong>NOTE:</strong> The Refresh button refreshes the page, displaying the current state of databases and tables loaded in HeatWave.</p>
</blockquote>

<h3 id="creating-backups">Creating Backups</h3>

<p>To create a DB System backup:</p>

<ol>
  <li>In the HeatWave Console, select the MySQL DB Systems tab. Under MySQL, select DB Systems.</li>
  <li>
    <p>In the list of DB Systems, find the DB System you want to create a backup for, and do one of the following:</p>

    <ul>
      <li>Click on the row of the DB System to highlight it, and choose Create Backup from the Actions menu.</li>
      <li>Click the name of the DB System to open the DB System Details page. Click Create Backup. The Create Backup dialog is displayed.</li>
    </ul>
  </li>
  <li>
    <p>Edit the fields as required:</p>

    <ul>
      <li>Display Name: The name of the backup.<br />
If you do not define a name, one is generated in the format <code class="language-plaintext highlighter-rouge">DB-System-Name - Backup - Date&amp;Time</code>.</li>
      <li>Description: The description of the backup.<br />
If you do not define a description, one is generated in the format <code class="language-plaintext highlighter-rouge">DB-System-Name - Manual Backup - Date&amp;Time</code>.</li>
    </ul>
  </li>
  <li>Click Create to create the backup.</li>
</ol>

<h3 id="maintenance">Maintenance</h3>

<p>Good news! Essential patching and maintenance of MySQL DB Systems is an automatic process. Patches of the underlying operating system, update versions (-uN) of the MySQL server, and any underlying hardware are performed during the Maintenance Window defined on the DB System. A Maintenance Window Start Time is defined for you, automatically, and can be viewed on the DB System Details page in the MySQL HeatWave on AWS Console.</p>

<p>When maintenance is performed, your DB System’s status changes to UPDATING and the DB System may be unavailable for a short time while the maintenance completes.</p>

<p>Such maintenance is performed infrequently, and only when absolutely necessary. This is usually for security or reliability issues.</p>

<h3 id="upgrading-mysql-server">Upgrading MySQL Server</h3>

<p>Use the Console to manually upgrade the MySQL Server of your DB system.</p>

<blockquote class="notice">
  <p><strong>NOTE:</strong> It is recommended to perform a full backup of your DB system before upgrading.</p>
</blockquote>

<ol>
  <li>In the HeatWave Console, select the MySQL DB Systems tab.</li>
  <li>Under MySQL, select DB Systems.</li>
  <li>
    <p>Find the DB system you want to upgrade, and do one of the following:</p>

    <ul>
      <li>Click on the row of the DB System to highlight it, and choose Edit MySQL Version from the Actions menu. If this option is not enabled, your DB system is already using the latest version of the MySQL Server.</li>
      <li>Click the name of the DB System to open the DB System Details page. Click Edit MySQL Version. If this button is not enabled, your DB system is already using the latest version of the MySQL Server.
 The Edit MySQL Version dialog is displayed.</li>
    </ul>
  </li>
  <li>In the Edit MySQL Version, select the required MySQL version.</li>
  <li>
    <p>Click Save Changes.</p>

    <p>The DB system enters the UPDATING state while the MySQL Server is upgraded.</p>
  </li>
</ol>

<h3 id="managing-a-heatwave-cluster">Managing a HeatWave Cluster</h3>

<p>When a HeatWave cluster is stopped through a stop or restart action, the data loaded in HeatWave cluster memory is lost.</p>

<h3 id="starting-stopping-or-restarting-a-heatwave-cluster">Starting, stopping, or restarting a HeatWave Cluster</h3>

<p>These actions have no effect on the DB System to which the HeatWave cluster is attached. However, start, stop, or restart actions on the DB System also affect the attached HeatWave cluster. When a HeatWave cluster is stopped as a result of a stop or restart action on the DB System, any data that was loaded on the HeatWave cluster must be reloaded when the HeatWave cluster is restarted.</p>

<p>To start, stop, or restart a HeatWave cluster:</p>

<ol>
  <li>In the HeatWave Console, select the HeatWave Clusters tab.</li>
  <li>
    <p>In the list of HeatWave clusters, find the HeatWave cluster you want to start, stop, or restart, and do one of the following:</p>

    <ul>
      <li>Click on the row of the HeatWave cluster to highlight it, and choose the required action from the Actions menu.</li>
      <li>Click the name of the HeatWave cluster to open the HeatWave Cluster Details page. On this page you can stop, start, or restart the HeatWave cluster.</li>
    </ul>
  </li>
  <li>
    <p>Select one of the following actions:</p>

    <ul>
      <li>Start: Starts a stopped HeatWave cluster. After the HeatWave cluster is started, the Stop action is enabled and the Start option is disabled.</li>
      <li>Stop: Stops a running HeatWave cluster. After the HeatWave cluster is stopped, the Start action is enabled.</li>
      <li>Restart: Shuts down a HeatWave cluster and restarts it.</li>
    </ul>
  </li>
</ol>

<h3 id="deleting-a-heatwave-cluster">Deleting a HeatWave Cluster</h3>

<p>Deleting a HeatWave cluster removes the HeatWave cluster nodes permanently. The DB System to which the HeatWave cluster is attached is unaffected. Perhaps you just want to crunch some data for a bit, while keeping costs low. Bear in mind, the cluster will need to be set up from scratch again after deletion, so there’s that.</p>

<p>To delete a HeatWave cluster:</p>

<ol>
  <li>In the HeatWave Console, select the HeatWave Clusters tab.</li>
  <li>
    <p>In the list of HeatWave clusters, find the HeatWave cluster you want to delete, and do one of the following:</p>

    <ul>
      <li>Click on the row of the HeatWave cluster to highlight it, and choose the Delete action from the Actions menu.</li>
      <li>Click the name of the HeatWave cluster to open the HeatWave Cluster Details page. Click the Delete button.
 The Delete HeatWave Cluster dialog is displayed.</li>
    </ul>
  </li>
  <li>Click Delete HeatWave cluster.</li>
</ol>

<p>That’s a top-level overview of getting your HeatWave on AWS set up, and a little bit of management.</p>

<p>Want to know more? Join the discussion in our <a href="https://bit.ly/devrel_slack">public Slack channel</a>!</p>]]></content><author><name>Victor Agreda</name></author><category term="cloudapps" /><category term="mysql" /><category term="database" /><category term="heatwave" /><category term="aws" /><summary type="html"><![CDATA[Getting signed up, signed on, and some basic management tasks for your HeatWave on AWS cluster.]]></summary></entry><entry><title type="html">HeatWave on AWS Metrics and Performance Tools</title><link href="https://cool.devo.build/tutorials/metrics-and-performance-hw-aws-devrel0622" rel="alternate" type="text/html" title="HeatWave on AWS Metrics and Performance Tools" /><published>2022-06-16T17:00:00+00:00</published><updated>2022-06-16T17:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/metrics-and-performance-hw-aws-devrel0622"><![CDATA[<p>As you’re working with your data, you’ll want to check out the performance of MySQL HeatWave on AWS, and we provide a number of metrics for you to examine.</p>

<h3 id="heatwave-cluster-workspaces">HeatWave Cluster Workspaces</h3>

<picture class="">
                <source srcset="assets/hwaws-query_already_run-devrel0622.png 1x" />
                <img loading="lazy" src="assets/hwaws-query_already_run-devrel0622.png" data-original="assets/hwaws-query_already_run-devrel0622.png" />
            </picture>

<p>Above, we see the Workspaces tab in the Console, having just run a query. While we see a memory snapshot, we can go deeper in the Performance tab.</p>

<h3 id="performance">Performance</h3>

<picture class="">
                <source srcset="assets/hw_performance_monitoring-devrel0622.png 1x" />
                <img loading="lazy" src="assets/hw_performance_monitoring-devrel0622.png" data-original="assets/hw_performance_monitoring-devrel0622.png" />
            </picture>

<p>Here’s the good stuff! Not only can you see performance per node, you can see the size of the dataset, the data dictionary, and if you click on Workload on the left side, you’ll see duration each step of the query took, and when queries have taken place.</p>

<picture class="">
                <source srcset="assets/hw_performance_monitoring_03-devrel0622.png 1x" />
                <img loading="lazy" src="assets/hw_performance_monitoring_03-devrel0622.png" data-original="assets/hw_performance_monitoring_03-devrel0622.png" />
            </picture>

<p>Clicking back on Cluster and scrolling down, we can see metrics related to the VM itself, including memory and connection usage, CPU, and so on. If you’re keen on squeezing every drop of performance that you can out of HeatWave on AWS, we got you.</p>

<picture class="">
                <source srcset="assets/hw_performance_monitoring_02-devrel0622.png 1x" />
                <img loading="lazy" src="assets/hw_performance_monitoring_02-devrel0622.png" data-original="assets/hw_performance_monitoring_02-devrel0622.png" />
            </picture>

<p>Want to know more? Join the discussion in our <a href="https://bit.ly/devrel_slack">public Slack channel</a>!</p>]]></content><author><name>Victor Agreda</name></author><category term="cloudapps" /><category term="mysql" /><category term="database" /><category term="heatwave" /><summary type="html"><![CDATA[A quick overview of the performance and metrics console windows in MySQL HeatWave on AWS.]]></summary></entry><entry><title type="html">Getting Started with MySQL HeatWave on AWS</title><link href="https://cool.devo.build/tutorials/oci-getting-started-heatwave-aws-v30622" rel="alternate" type="text/html" title="Getting Started with MySQL HeatWave on AWS" /><published>2022-06-16T17:00:00+00:00</published><updated>2022-06-16T17:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/oci-getting-started-heatwave-aws-v30622"><![CDATA[<p>We live in a multi-cloud world, and that’s why MySQL HeatWave for Amazon Web Service makes so much sense if you need a massively parallel, high performance, in-memory query accelerator for the MySQL Database Service. A combination that accelerates MySQL performance by orders of magnitude for combined analytics and transactional workloads (OLAP and OLTP). The MySQL Database Service is built on MySQL Enterprise Edition, which allows developers to quickly create and deploy secure cloud native applications using the world’s most popular open source database.</p>

<p>Oracle designed this so developers can focus on the important things, like managing data, creating schemas, and providing highly-available applications. MySQL HeatWave for Amazon Web Services (AWS) is a fully managed service, developed and supported by the MySQL team in Oracle. Oracle automates tasks such as backup, recovery, and database and operating system patching. “Worry less, crunch more,” as we say!</p>

<p>If you’ve never heard of HeatWave, think of it as a database query accelerator with boost buttons. As in The Fast and the Furious, when you want to pull ahead of the competition, you hit the NO2 and get the speed you need, right when you need it. And of course, this efficiency means it’s a little less expensive to run those big queries. One of the incredible things about Oracle MySQL HeatWave is the ability to <a href="https://www.oracle.com/mysql/heatwave/">run analytics</a> directly against your existing transactional data, so there’s no need to shuffle that data off to a separate system when you need to perform massively parallel analysis.</p>

<p>To get started, we’ll create a compartment and install MySQL Shell due to its extended capabilities over vanilla MySQL and create a small database so we can eventually connect it to HeatWave for analysis. Note that this is working within Oracle Cloud, but we’ll cover AWS setup in another tutorial to show you how you can leverage HeatWave in a multi-cloud scenario. What a time to be alive!</p>

<p>Let’s look at how to get started. If you’re already developing in Oracle Cloud (OCI), you’ll find it’s relatively easy to get going, as HeatWave on AWS is integrated with OCI’s Identity and Access Management system. When you sign up for HeatWave on AWS, you’ll be directed to the OCI login page where you must sign in with an OCI Cloud Account. After signing in, you’ll be directed to the OCI Console to complete the MySQL HeatWave on AWS sign-up process. When signing into the HeatWave Console, you are directed to OCI for authentication and then back to the HeatWave Console. To keep things simple, billing is still managed and monitored in OCI.</p>

<p>Since we’re just getting started, let’s begin truly at the beginning and create a compute instance with the proper access rules and see how to create a HeatWave cluster in OCI. If you’re already using AWS, we’ll cover that in a separate tutorial.</p>

<h2 id="prerequisites">PREREQUISITES</h2>

<ul>
  <li>An OCI account and Oracle Cloud Account name</li>
  <li>Admin access</li>
  <li>A compatible browser (Chrome 69+, Safari 12.1+, or Firefox 62+ or any browser that is Oracle Jet-approved)</li>
</ul>

<h2 id="overview">OVERVIEW</h2>

<p>MySQL HeatWave on AWS uses predefined Oracle Identity Cloud Service (IDCS) groups and policies to control user access to MySQL HeatWave on AWS and the type of access. You should have the ability to create and modify policies, users, and the like. Also, we are assuming you’re creating the database and administering it, or at least getting the prep work done. Look at you, a one-stop shop!</p>

<ol>
  <li>Create a Compartment</li>
  <li>Create a a VCN and configure for database access</li>
  <li>Create users and groups (if you haven’t already)</li>
  <li>Create a Bastion Host compute instance</li>
  <li>Connect and Install MySQL Shell</li>
  <li>Create a MySQL database</li>
  <li>Create a DB System with HeatWave-compatible shape</li>
  <li>Activate HeatWave on AWS</li>
</ol>

<p>Wondering why this is a “bastion host”? You can read more about bastions in this <a href="https://www.oracle.com/security/cloud-security/bastion/">article</a>.</p>

<blockquote class="notice">
  <p><strong>NOTE</strong>: Once you’re connecting databases and analytics, there’s a better production method for connecting, and that’s creating a Private Access Channel (OAC), which you can learn all about in the article, <a href="https://blogs.oracle.com/analytics/post/how-to-create-oac-instances-on-oci-native-using-multiple-stripes-or-instances-of-idcs">How to create OAC instances on OCI Native using multiple stripes or instances of IDCS</a></p>
</blockquote>

<p>In our example, we’re using a quick and dirty approach to set things up to use HeatWave.</p>

<p>Now let’s get started with the basics! We begin by slicing off a piece of the cloud as our own little homestead. There are a couple of ways to do this, but one of the simplest is to create a Compartment (you could also start with a Compute instance). This is a “place for your stuff” within your tenancy and is quite flexible. As you might imagine, we need to create a group of users who can administer our system, and Identity and Access Management (IAM) is where you’ll go to configure this for any compartments you create.</p>

<h2 id="create-a-compartment">Create a Compartment</h2>

<picture class="">
                <source srcset="assets/create-compartment-hwaws-devrel0266va.png 1x" />
                <img loading="lazy" src="assets/create-compartment-hwaws-devrel0266va.png" data-original="assets/create-compartment-hwaws-devrel0266va.png" />
            </picture>

<p><strong>Menu:</strong> Home &gt; Identity &amp; Security &gt; Compartments</p>

<p>I could have set all of this up in my root compartment, but a new compartment is better way to organize things.</p>

<p>Creating compartments is a simple matter, and a necessary starting point to organize and configure your work. I’ve named mine something clever, like <em>my_heatwave_testing</em> so I know what it’s for.</p>

<h2 id="create-a-vcn-and-configure-for-database-access">Create a VCN and configure for database access</h2>

<p><strong>Menu:</strong> Home &gt; Networking &gt; Virtual Cloud Networks</p>

<ol>
  <li>
    <p>Create VCN and subnets using <strong>Virtual Cloud Networks &gt; Start VCN Wizard &gt; Create a VCN with Internet Connectivit</strong>y.</p>

    <picture class="">
             <source srcset="assets/start_a_vcn_wizard-devrel0622va.png 1x" />
             <img loading="lazy" src="assets/start_a_vcn_wizard-devrel0622va.png" data-original="assets/start_a_vcn_wizard-devrel0622va.png" />
         </picture>

    <p>The handy wizard will walk you through creating a network interface for your system, although there are lots of ways to configure this, let’s not get distracted. Notice that I chose the compartment I set up earlier, my_heatwave_testing – because that’s important!</p>

    <picture class="">
             <source srcset="assets/vcn_config_screen2-devrel0622va.png 1x" />
             <img loading="lazy" src="assets/vcn_config_screen2-devrel0622va.png" data-original="assets/vcn_config_screen2-devrel0622va.png" />
         </picture>
  </li>
  <li>
    <p>Now let’s configure the VCN’s security list to allow traffic through MySQL Database Service ports.<br />
Click on the <strong>Private Subnet</strong> for the VCN you created, then click the <strong>Security List</strong> for it.</p>

    <picture class="">
             <source srcset="assets/vcn_edit_subnet_s1-devrel0622va.png 1x" />
             <img loading="lazy" src="assets/vcn_edit_subnet_s1-devrel0622va.png" data-original="assets/vcn_edit_subnet_s1-devrel0622va.png" />
         </picture>
  </li>
  <li>
    <p>Now click <strong>Add Security</strong> list.</p>

    <ol>
      <li>
        <p>We’ll add some ingress rules needed to enable the right ports, <code class="language-plaintext highlighter-rouge">3306</code> and <code class="language-plaintext highlighter-rouge">33060</code>.<br />
Here’s the details:</p>

        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">   Source CIDR: 0.0.0.0/0

   Destination Port Range: 3306,33060

   Description: MySQL Port
</span></code></pre></div>        </div>
      </li>
      <li>
        <p>And click <strong>Add Ingress Rules</strong>.</p>

        <picture class="">
          <source srcset="assets/vcn_ingress_rules_example-devrel0622va.png 1x" />
          <img loading="lazy" src="assets/vcn_ingress_rules_example-devrel0622va.png" data-original="assets/vcn_ingress_rules_example-devrel0622va.png" />
      </picture>

        <p>Looking good so far!</p>
      </li>
    </ol>
  </li>
</ol>

<h2 id="create-users-and-groups-if-you-havent-already">Create users and groups (if you haven’t already)</h2>

<p>We’ll need to set permissions and limit access somewhat, even in our “quick and dirty” example, but you can <a href="https://docs.oracle.com/en-us/iaas/Content/Identity/Tasks/managinggroups.htm">read all about managing groups here</a>. Usually we’ll create a group, create policies, then add users to the group.</p>

<p>Let’s make friends with the <strong>Identity and Security</strong> options.</p>

<ol>
  <li>
    <p>Create a group for your users.<br />
In my example I’ve created a group called database_user (just to be confusing, as I should have named it database_admins, but this was just a clever ploy to keep you on your toes).</p>
  </li>
  <li>
    <p>Add users to the group.<br />
In our example, we’ll add ourselves to this group that will administer our compute instance running MySQL-shell.</p>

    <p>Of course, for a group you’ll first create all the users you need, add those into the group needing access at the levels you determine, and rest assured that you can set them loose with appropriate access controls.</p>
  </li>
  <li>
    <p>We allow access by setting policies, allowing one group to have full access (admins), and a group with limited access (database users, for example).</p>

    <p>For MySQL HeatWave on AWS, there are some specific policy statements we can use, detailed in the charts below.</p>

    <picture class="">
             <source srcset="assets/hw_policy_aws_statements-devrel0622va.png 1x" />
             <img loading="lazy" src="assets/hw_policy_aws_statements-devrel0622va.png" data-original="assets/hw_policy_aws_statements-devrel0622va.png" />
         </picture>

    <p>This is just making it possible to configure and administrate our compartment, and defines the scope of the access applied to the database instance.</p>
  </li>
</ol>

<p>For more on adding users and setting policies in OCI, refer to <a href="https://docs.oracle.com/en-us/iaas/Content/GSG/Tasks/addingusers.htm#Add">this documentation</a>.</p>

<h2 id="create-a-bastion-host-compute-instance">Create a Bastion Host Compute Instance</h2>

<p><strong>MENU:</strong> Main &gt; Compute &gt; Instances</p>

<p>Be sure to select the compartment you set up earlier, under <strong>List Scope</strong>.</p>

<picture class="">
                <source srcset="assets/compute_hw_listscope_compartment-devrel0622va.png 1x" />
                <img loading="lazy" src="assets/compute_hw_listscope_compartment-devrel0622va.png" data-original="assets/compute_hw_listscope_compartment-devrel0622va.png" />
            </picture>

<picture class="">
                <source srcset="assets/create_instance_hw_devrel_0522-0622va.png 1x" />
                <img loading="lazy" src="assets/create_instance_hw_devrel_0522-0622va.png" data-original="assets/create_instance_hw_devrel_0522-0622va.png" />
            </picture>

<h3 id="create-instance">Create Instance</h3>

<p>Click <strong>Create Instance</strong> (easy, right?)</p>

<p>Name it something useful, and right now we’ll leave the Availability Domain, Fault Domain, Image, and Shape as-is. You can use a free-tier compute!</p>

<p>We’re going to use Oracle Linux, but one of the niceties here are the choices of compute shapes and Linux distributions to choose from. There’s even a developer distro, which comes pre-configured with key frameworks. For our purposes, we’ll want to make sure it’s set up to work with HeatWave. Plus, we’ll use a Bastion Host for better security. Bastions provide “restricted and time-limited access to target resources that don’t have public endpoints,” and you can <a href="https://docs.oracle.com/en-us/iaas/Content/Bastion/Concepts/bastionoverview.htm">read all about them in this overview article</a>.</p>

<picture class="">
                <source srcset="assets/create_compute_hw_devrel0522aa.png 1x" />
                <img loading="lazy" src="assets/create_compute_hw_devrel0522aa.png" data-original="assets/create_compute_hw_devrel0522aa.png" />
            </picture>

<h4 id="launching-a-linux-instance">Launching a Linux instance</h4>

<p>If you want to know more, <a href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/launchinginstance.htm">here’s a tutorial on launching a Linux instance</a>, but I’ll walk you through the basics now. Bear in mind that our compute instance can be pretty minimal, and there are free tier shapes that could work (<a href="https://www.oracle.com/cloud/free/">our always-free tier VM</a> is quite generous).</p>

<picture class="">
                <source srcset="assets/compute_network_hw_devrel0522aa.png 1x" />
                <img loading="lazy" src="assets/compute_network_hw_devrel0522aa.png" data-original="assets/compute_network_hw_devrel0522aa.png" />
            </picture>

<h3 id="networking">Networking</h3>

<p>Scrolling down, you’ll see the <strong>Networking</strong> section. Here you’ll want to make sure to use the <a href="#create-a-vcn-and-configure-for-database-access">VCN you created previously</a>, as well as make sure you’re in the proper compartment.</p>

<h3 id="generate-ssh-keys">Generate SSH keys</h3>

<p>And of course, during this process you’ll generate SSH keys so you can access your computer instance remotely. You can do this within the Cloud Shell in OCI’s dashboard, or the SSH client of your choice.</p>

<h4 id="let-oracle-make-it-easy">Let Oracle make it easy</h4>

<p>Also, the path of least resistance for creating a key pair will be letting Oracle generate one. The key pair will allow you to log in remotely and install MySQL-shell, etc.</p>

<blockquote class="notice">
  <p><strong>NOTE:</strong> In many labs we’ll have you use the Cloud Shell, which is a convenient command line interface available directly in the OCI dashboard. I’m old school, so I’m just using Terminal on my Mac. You can use the SSH client of your choice, of course!</p>
</blockquote>

<p>For more information see:</p>

<ul>
  <li><a href="https://docs.oracle.com/en-us/iaas/developer-tutorials/tutorials/node-on-ol/01oci-ol-node-summary.htm#install-node-ol">Install Node Express on an Oracle Linux Instance</a></li>
  <li><a href="https://www.youtube.com/watch?v=LMvYOSkXF1k">A video on working with SSH keys</a>.</li>
</ul>

<h3 id="obtain-public-ip-for-compute-instance">Obtain public IP for compute instance</h3>

<p>Of course, you’ll need the public IP for your compute instance, which is found in <strong>Compute &gt; Instances &gt; Instance details</strong>. Under <strong>Instance Access</strong> you’ll find the public IP and username (opc) you’ll need to connect, with a handy <strong>copy</strong> button.</p>

<picture class="">
                <source srcset="assets/heres-public-ip-hw-oci-fy23-devrel.png 1x" />
                <img loading="lazy" src="assets/heres-public-ip-hw-oci-fy23-devrel.png" data-original="assets/heres-public-ip-hw-oci-fy23-devrel.png" />
            </picture>

<p>Now, we’ll be able to <a href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/accessinginstance.htm">connect via SSH or the Cloud Shell</a>, and since you have a public IP, you can just ssh in to your compartment and the OCI Linux compute instance.</p>

<p>As always, keep the private key in a safe place and <code class="language-plaintext highlighter-rouge">chmod 400</code> the private key to keep it from being modified (and throwing a warning).</p>

<h3 id="provision-the-instance">Provision the Instance</h3>

<p>Go ahead and click <strong>Create</strong>.</p>

<p>It’ll take a moment for the provisioning to finish up, but when it’s done the large square icon will turn green, meaning all systems are GO!</p>

<h2 id="connect-and-install-mysql-shell">Connect and install MySQL Shell</h2>

<p>To connect, let’s use the handy Cloud Shell. It’s a little Linux terminal embedded in the OCI dashboard (and it’s adorable).</p>

<ol>
  <li>
    <p>In the upper-right corner, click the <strong>Cloud Shell</strong> prompt icon and a command line will open at the bottom of the browser.</p>

    <picture class="">
             <source srcset="assets/cloudshelliconhwtesting-devrel0622va.png 1x" />
             <img loading="lazy" src="assets/cloudshelliconhwtesting-devrel0622va.png" data-original="assets/cloudshelliconhwtesting-devrel0622va.png" />
         </picture>
  </li>
  <li>
    <p>Drag and drop the previously saved private key into the cloud shell, uploading it to your home directory.</p>

    <picture class="">
             <source srcset="assets/cloudshelluploadprivkey_hwdevrel-devrel0622va.png 1x" />
             <img loading="lazy" src="assets/cloudshelluploadprivkey_hwdevrel-devrel0622va.png" data-original="assets/cloudshelluploadprivkey_hwdevrel-devrel0622va.png" />
         </picture>
  </li>
  <li>
    <p>Under Instance Access, you’ll see the public IP address, and the handy <strong>Copy</strong> button. Copy the public IP.</p>
  </li>
  <li>
    <p>Now let’s ssh in, first protecting the private key file.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">   chmod 400 &lt;private-key-filename&gt;</span>.key
</code></pre></div>    </div>
  </li>
  <li>
    <p>Then use your public IP address and username opc:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">   ssh -i &lt;private-key-file-name&gt;</span>.key opc@&lt;compute_instance_public_ip&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>If asked to accept the fingerprint, type <em>yes</em> and hit <strong>enter</strong>.<br />
You’ve been added to the list of known hosts, congrats. We’re in! If you see Tron, wave.</p>
  </li>
  <li>
    <p>Now we install MySQL Shell; pretty easy these days. In my case, I used SSH to log into my compute instance (don’t forget you’ll need your private key) and used yum to install what I needed.</p>

    <p>Install the MySQL Client on the compute instance using the following command:<br />
<code class="language-plaintext highlighter-rouge">sudo yum install mysql-shell</code></p>
  </li>
  <li>
    <p>Once we create our HeatWave-compatible DB System, we’ll connect to to it using the MySQL Client:<br />
<code class="language-plaintext highlighter-rouge">mysqlsh --host &lt;DBSystemEndpointIPAddress&gt; -u &lt;Username&gt; -p</code></p>
  </li>
</ol>

<p>For more information see:</p>

<ul>
  <li>
    <p><a href="https://dev.mysql.com/doc/mysql-shell/8.0/en/">Learning about MySQL Shell</a>.</p>
  </li>
  <li>
    <p><a href="https://docs.oracle.com/en-us/iaas/mysql-database/doc/connecting-db-system.html#GUID-70023ABD-5418-4C1F-975F-F3E2ABC0F93E">Learning about connecting database systems</a>.</p>
  </li>
</ul>

<h2 id="create-a-db-system">Create a DB System</h2>

<p>Remember a little while ago when we mentioned the endpoint for your DB System? Let’s set that up now.</p>

<p><strong>MENU:</strong> Menu &gt; Databases &gt; DB Systems</p>

<picture class="">
                <source srcset="assets/createdbsys_warn_devrel_0522va.png 1x" />
                <img loading="lazy" src="assets/createdbsys_warn_devrel_0522va.png" data-original="assets/createdbsys_warn_devrel_0522va.png" />
            </picture>

<blockquote class="notice">
  <p><strong>NOTE:</strong> Notice that the system warns you if you haven’t already set up users, a VCN, and so on. That’s nice.<br />
Also, don’t forget to check which compartment you’ll create this in, again under <strong>List Scope</strong> on the left.</p>
</blockquote>

<ol>
  <li>
    <p>Click <strong>Create DB System</strong>.</p>

    <p>Double-check the compartment, give it a name, and select HeatWave (of course).</p>
  </li>
  <li>
    <p>You’ll create admin credentials.<br />
Be sure to save those somewhere handy but safe!</p>
  </li>
  <li>In <strong>Configure Networking</strong>, you’ll use the compute instance created earlier, but we’ll use the private subnet. Leave the default domain.</li>
  <li>
    <p>Go to <strong>Configure Hardware</strong>.</p>

    <p>Confirm that in the <strong>Configure Hardware</strong> section, the selected shape is <code class="language-plaintext highlighter-rouge">MySQL.HeatWave.VM.Standard.E3</code>.</p>

    <p>Also, confirm that:</p>

    <ul>
      <li>CPU Core Count: 16,</li>
      <li>Memory Size: 512 GB,</li>
      <li>Data Storage Size: 1024</li>
    </ul>
  </li>
  <li>
    <p>In the <strong>Configure Backup</strong> section you may leave the default backup window of 7 days.</p>
  </li>
  <li>
    <p>Keep scrolling and click <strong>Show Advanced Options</strong>.</p>

    <ol>
      <li>
        <p>Go to the <strong>Networking</strong> tab.<br />
In the <strong>Hostname</strong> field, enter the exact name of your DB System.</p>
      </li>
      <li>
        <p>Make sure port configuration corresponds to the following:</p>

        <ul>
          <li>MySQL Port: 3306</li>
          <li>MySQL X Protocol Port: 33060</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>
    <p>And… click <strong>Create</strong>!</p>

    <p>This time a yellow hexagon will appear, and eventually it’ll turn green and your DB System will be up and running. Make some tea or grab some water, you’ve done a lot.</p>
  </li>
</ol>

<h2 id="create-a-mysql-database">Create a MySQL database</h2>

<p>Now, you’ll want to create your database and import any data you need. HeatWave is really designed for big data sets needing fast analysis, so even though I’m importing the tiniest database ever, you can load up as much as you like (provided you have the storage for it). Plus, queries can be run in the cluster without offloading to a separate database. Whether you’re deploying to OCI or AWS, we got you.</p>

<p>Finally, the fun part! Import a .sql file.</p>

<h3 id="from-the-command-line">From the command line</h3>

<p>Type: <code class="language-plaintext highlighter-rouge">mysql -u username -p database_name &lt; file.sql</code></p>

<p>Where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">username</code> refers to your MySQL username.</li>
  <li><code class="language-plaintext highlighter-rouge">database_name</code> refers to the database you want to import.</li>
  <li><code class="language-plaintext highlighter-rouge">file.sql</code> is your file name.</li>
  <li>If you’ve assigned a password, type it now and press <strong>Enter</strong>.</li>
</ul>

<p>For more information:</p>

<ul>
  <li><a href="https://www.youtube.com/watch?v=gvcBDA2wJJ4">Here’s a video on importing using the command line</a>.</li>
</ul>

<h3 id="using-mysqldump">Using mysqldump</h3>

<p>Lots of fans of mysqldump out there, so here’s how that works (using a made-up database for magazines):</p>

<ol>
  <li>To import a .sql file with mysqldump, use the <code class="language-plaintext highlighter-rouge">mysqlimport</code> command with the following flags and syntax:
<code class="language-plaintext highlighter-rouge">$ mysqlimport -u magazine_admin -p magazines_production ~/backup/database/magazines.sql</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">-u</code> and <code class="language-plaintext highlighter-rouge">-p</code> are needed for authentication, and is then followed by the name of the database you want to import into.</li>
      <li>You’ll need to specify the path to your SQL dump file that will contain your import data: <code class="language-plaintext highlighter-rouge">~/backup/database/magazines.sql</code></li>
      <li>You won’t need to use <code class="language-plaintext highlighter-rouge">&gt;</code> or <code class="language-plaintext highlighter-rouge">&lt;</code> for importing, but you will need them for exporting in the next guide.</li>
      <li>This will prompt a password request.</li>
    </ul>
  </li>
  <li>Your file will be automatically imported.</li>
</ol>

<p>Now that we have some data, we probably want to DO stuff with it, including visualize it in various ways. Let’s add some analytics to accomplish this – and continue our journey to the really big show, HeatWave. This is where things get really interesting, and you can see how Oracle has created a vast menu of options for your data needs.</p>

<p>The key is that you have a database running on OCI, and that database now has an endpoint which we can connect to HeatWave for analytics.</p>

<h2 id="activate-heatwave-on-aws">Activate HeatWave on AWS</h2>

<p>Remember the DB System we just created? Now we can activate MySQL HeatWave in AWS and connect our DB System to a HeatWave Cluster to run queries on!</p>

<ol>
  <li>
    <p>You’ll go to <a href="http://cloud.mysql.com/">http://cloud.mysql.com/</a>, where you’ll see the welcome page.<br />
Enter your Oracle Cloud Account name and click <strong>Continue</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Enable MySQL HeatWave on AWS</strong>.<br />
This takes you to a Admin page where you will go through a brief setup process. You may have to upgrade your account to paid with a credit card, and once complete, you’ll go to the OCI Console. Try not to time this for the last minute, as provisioning may take a moment.</p>
  </li>
  <li>
    <p>From the OCI Console navigation menu, select <strong>Databases</strong>.</p>

    <p>MySQL HeatWave on AWS appears on the Home tab under the Featured label.</p>
  </li>
  <li>
    <p>Under <strong>MySQL HeatWave on AWS</strong>, click <strong>Administration</strong>, and you’ll go back to the setup.</p>
  </li>
  <li>
    <p>Now click <strong>Provision</strong> to (of course) provision MySQL on AWS. 
After the provisioning operation is completed, a message appears stating that MySQL HeatWave on AWS is ready and you are presented with options to open the MySQL HeatWave console, set up users, and view billing information.</p>
  </li>
</ol>

<h2 id="summary---so-far">Summary - so far</h2>

<p>What we’ve done so far, all on OCI, is set up a Virtual Cloud Network with ports for MySQL use, created a Bastion Compute instance, then set up a MySQL database, and now we have an endpoint for our HeatWave on AWS instance, and HeatWave should be provisioned on AWS.</p>

<p>Want to know more? Join the discussion in our <a href="https://bit.ly/devrel_slack">public Slack channel</a>!</p>]]></content><author><name>Victor Agreda</name></author><category term="cloudapps" /><category term="mysql" /><category term="database" /><category term="heatwave" /><category term="aws" /><summary type="html"><![CDATA[Getting your OCI tenancy ready to connect to MySQL HeatWave on AWS. We will create a compute instance, DB System, and endpoint. We also began to provision MySQL HeatWave on AWS.]]></summary></entry><entry><title type="html">Using the AWS Migration Service with HeatWave on AWS with WordPress as an Example</title><link href="https://cool.devo.build/tutorials/using-aws-migration-service-wp-ex-devrel0622" rel="alternate" type="text/html" title="Using the AWS Migration Service with HeatWave on AWS with WordPress as an Example" /><published>2022-06-16T17:00:00+00:00</published><updated>2022-06-16T17:00:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/using-aws-migration-service-wp-ex-devrel0622"><![CDATA[<p>Now let’s try something really fun. Let’s say you’ve already got a database using Aurora or RDS, in our case we’ll use a WordPress database, and you want to migrate it to MySQL HeatWave on AWS.</p>

<p>First, we’ll need to have a MySQL DB System on HeatWave already, and a critical step is opening port 3306, shown below.</p>

<picture class="">
                <source srcset="assets/create-mysqldbsys-devrel0622.png 1x" />
                <img loading="lazy" src="assets/create-mysqldbsys-devrel0622.png" data-original="assets/create-mysqldbsys-devrel0622.png" />
            </picture>

<p>Great! Now let’s head over to AWS.</p>

<ol>
  <li>
    <p>Log in to your AWS console, and use search for “DMS” — Database Migration Service, it’ll be the top result.</p>

    <picture class="">
             <source srcset="assets/awsdbs-migrationservice-search-devrel0622.png 1x" />
             <img loading="lazy" src="assets/awsdbs-migrationservice-search-devrel0622.png" data-original="assets/awsdbs-migrationservice-search-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>Click Create replication instance.</p>

    <picture class="">
             <source srcset="assets/step2-create-replication-awshw-devrel0622.png 1x" />
             <img loading="lazy" src="assets/step2-create-replication-awshw-devrel0622.png" data-original="assets/step2-create-replication-awshw-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>Fill out a Name, Amazon Resource Name (ARN), description. You may use whichever shape you like, but keep in mind performance:cost here. Engine version should be fine, as well as storage (unless you have a truly massive database, in which case adjust accordingly).</p>

    <picture class="">
             <source srcset="assets/arn-form-repinstance-awshw-devrel0622.png 1x" />
             <img loading="lazy" src="assets/arn-form-repinstance-awshw-devrel0622.png" data-original="assets/arn-form-repinstance-awshw-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>For VPC, choose one you have previously set up with the appropriate access controls for development work. And make sure it is publicly accessible. For Multi AZ, we’ll use a single availability zone, dev or test workload.</p>

    <picture class="">
             <source srcset="assets/step4-vpcsetup-awshw-devrel0622.png 1x" />
             <img loading="lazy" src="assets/step4-vpcsetup-awshw-devrel0622.png" data-original="assets/step4-vpcsetup-awshw-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>Click to open the Advanced security and network configurations. The subnet group will follow the VPC you chose above, and the availability zone should be US-East. The security groups should be populated with any you created earlier, ensuring ports are available (LINK TK to DOCS on this).</p>

    <picture class="">
             <source srcset="assets/step5-advanc-netsec-awshw-devrel0622.png 1x" />
             <img loading="lazy" src="assets/step5-advanc-netsec-awshw-devrel0622.png" data-original="assets/step5-advanc-netsec-awshw-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>It will take a few minutes for the replication instance to spin up. Coffee time!</p>

    <picture class="">
             <source srcset="assets/step6-creating-instance-awshw-wpex-devrel0622.png 1x" />
             <img loading="lazy" src="assets/step6-creating-instance-awshw-wpex-devrel0622.png" data-original="assets/step6-creating-instance-awshw-wpex-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>Once it’s ready, we’ll need to get the Public IP address for our endpoint. Go to the Endpoints section. On the right you’ll see a Create Endpoint button, click it.</p>

    <picture class="">
             <source srcset="assets/step7a-awsdms-endpoints-awshw-wpex-devrel0622.png 1x" />
             <img loading="lazy" src="assets/step7a-awsdms-endpoints-awshw-wpex-devrel0622.png" data-original="assets/step7a-awsdms-endpoints-awshw-wpex-devrel0622.png" />
         </picture>
    <picture class="">
             <source srcset="assets/step7b-create-endpoint-button-awshw-wpex-devrel0622.png 1x" />
             <img loading="lazy" src="assets/step7b-create-endpoint-button-awshw-wpex-devrel0622.png" data-original="assets/step7b-create-endpoint-button-awshw-wpex-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>Select Source endpoint, and check Select RDS DB Instance. You should see the RDS Instance field populate with what’s available to you.</p>

    <picture class="">
             <source srcset="assets/step8-create-endpoint-awshw-wpex-devrel0622.png 1x" />
             <img loading="lazy" src="assets/step8-create-endpoint-awshw-wpex-devrel0622.png" data-original="assets/step8-create-endpoint-awshw-wpex-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>For Endpoint configuration, you’ll have the identifier, ARN, and source engine pre-filled, but we want to provide the access to endpoint database information manually, so click that radio button. Then, enter the appropriate database information for the db you’re moving over.</p>

    <picture class="">
             <source srcset="assets/step9-endpoint-config-awshw-devrel0622.png 1x" />
             <img loading="lazy" src="assets/step9-endpoint-config-awshw-devrel0622.png" data-original="assets/step9-endpoint-config-awshw-devrel0622.png" />
         </picture>
  </li>
  <li>
    <p>Then, you should be able to test the endpoint connection below.</p>

    <picture class="">
            <source srcset="assets/step10-testendpoint-awshw-wpex-devrel0622.png 1x" />
            <img loading="lazy" src="assets/step10-testendpoint-awshw-wpex-devrel0622.png" data-original="assets/step10-testendpoint-awshw-wpex-devrel0622.png" />
        </picture>
  </li>
  <li>
    <p>Now, we’ll create a second endpoint as our destination.
To do this, we return to the MySQL HeatWave on AWS Console, and click MySQL DB Systems.</p>

    <picture class="">
            <source srcset="assets/step11-mysql-dbsystems-onaws-awshw-wpex-devrel0622.png 1x" />
            <img loading="lazy" src="assets/step11-mysql-dbsystems-onaws-awshw-wpex-devrel0622.png" data-original="assets/step11-mysql-dbsystems-onaws-awshw-wpex-devrel0622.png" />
        </picture>

    <p>Then, click on the DB System you wish to use, and in Summary you will find the Host Name. Copy the string.</p>
  </li>
  <li>
    <p>Go back to AWS console, and click to create another endpoint. Except this time we’ll create a Target endpoint! Naturally.</p>

    <picture class="">
            <source srcset="assets/step12-create-endpoint-aws-awshw-wpex-devrel0622.png 1x" />
            <img loading="lazy" src="assets/step12-create-endpoint-aws-awshw-wpex-devrel0622.png" data-original="assets/step12-create-endpoint-aws-awshw-wpex-devrel0622.png" />
        </picture>
  </li>
  <li>
    <p>In Endpoint configuration, give it a name (identifier), choose MySQL under Target Engine. ARN is optional.</p>

    <picture class="">
            <source srcset="assets/step13-target-engin-awshw-wpex-devrel0622.png 1x" />
            <img loading="lazy" src="assets/step13-target-engin-awshw-wpex-devrel0622.png" data-original="assets/step13-target-engin-awshw-wpex-devrel0622.png" />
        </picture>
  </li>
  <li>
    <p>Once again, we’ll provide access information manually. The server name is the host name you previously copied. Port is 3306. The username/password will match the one you created for the target database.</p>
  </li>
  <li>
    <p>Now you have your endpoint, username/password, and can use this when creating a HeatWave on AWS cluster to connect a DB System and run queries. Refer to the HeatWave on AWS documentation for more.</p>
  </li>
</ol>

<blockquote class="notice">
  <p><strong>Note:</strong> MySQL Shell is the recommended utility for exporting data from a source MySQL Server and importing it into a DB System on the MySQL HeatWave on AWS. MySQL Shell dump and load utilities are purpose- built for use with MySQL DB Systems. For more on running queries with HeatWave, please refer to the <a href="https://dev.mysql.com/doc/heatwave/en/heatwave-running-queries.html">MySQL documentation</a>.</p>
</blockquote>

<p>Want to know more? Join the discussion in our <a href="https://bit.ly/devrel_slack">public Slack channel</a>!</p>]]></content><author><name>Victor Agreda</name></author><category term="cloudapps" /><category term="mysql" /><category term="database" /><category term="heatwave" /><summary type="html"><![CDATA[A quick example of how you can move data over for use in MySQL HeatWave on AWS.]]></summary></entry><entry><title type="html">Creating a Simple Chatbot using NodeJS on OCI</title><link href="https://cool.devo.build/tutorials/create-simple-chatbot-nodejs-oci" rel="alternate" type="text/html" title="Creating a Simple Chatbot using NodeJS on OCI" /><published>2022-05-26T19:42:00+00:00</published><updated>2022-05-26T19:42:00+00:00</updated><id>https://cool.devo.build/</id><content type="html" xml:base="https://cool.devo.build/tutorials/create-simple-chatbot-nodejs-oci"><![CDATA[<h2 id="introduction-why-this">Introduction: Why this?</h2>

<picture class="">
                <source srcset="assets/racterexaemplasdfsdfsdf.jpg 1x" />
                <img loading="lazy" src="assets/racterexaemplasdfsdfsdf.jpg" data-original="assets/racterexaemplasdfsdfsdf.jpg" />
            </picture>

<p>When I started this project I wanted to make a Racter-like chatbot. For those who don’t remember, Racter was a weird little text “conversation simulator” released in the 1980s by publisher Mindscape, known for educational software. I wound up playing quite a bit on my dad’s Apple //c instead of my computer because his had a printer, and you could print out conversations – presumably to share them with friends. A literal “share sheet,” if you will.</p>

<picture class="">
                <source srcset="assets/apple2cvhanodejsasdfsd.jpg 1x" />
                <img loading="lazy" src="assets/apple2cvhanodejsasdfsd.jpg" data-original="assets/apple2cvhanodejsasdfsd.jpg" />
            </picture>

<p>However, what I wound up doing is establishing the beginnings of a home assistant. Racter is pretty outdated tech, as it just takes nouns you say and adds them into sentences. Very much like Mad Libs, but weirder. You can actually <a href="https://www.myabandonware.com/game/racter-4m/play-4m">try out Racter on the Abandonware site</a>. Let’s face it, home assistants are much more conversational and practical these days.</p>

<p>I have a mix of IOT devices in my home, but have lately become a fan of open source projects that integrate the disparate platforms (Amazon, Apple, and Google, primarily) and increase privacy. To start, I looked around for some existing “chatbots” and found <a href="https://github.com/Programmer101N/chatbot_nodejs">this clever implementation</a> by <a href="https://github.com/Programmer101N">Naman Baranwall</a>, which uses a little bit of training to choose the best response. Obviously we’ll be adding to this later, but for now, I wanted to show how to get this up and running on Oracle Cloud Infrastructure (OCI). It was honestly a lot easier than I thought it would be! But note that we’re going for the shortest distance between two points, and that’s getting the application running using NodeJS. If this were a production environment, we’d likely use bastions and some stricter access controls. All in good time!</p>

<h2 id="pre-requisites">Pre-Requisites</h2>

<ul>
  <li>OCI Free Tier account</li>
  <li>Wait, that’s it???</li>
</ul>

<p>You may want a GitHub account if you want to branch the project as I did for extension later, but honestly this is all so simple you’ll be amazed.</p>

<h2 id="steps">Steps</h2>

<ol>
  <li>
    <p>Create a compartment</p>

    <p>Menu: Identity and Security &gt; Instances</p>

    <picture class="">
            <source srcset="assets/2instancesinmycompartment.png 1x" />
            <img loading="lazy" src="assets/2instancesinmycompartment.png" data-original="assets/2instancesinmycompartment.png" />
        </picture>

    <p>The point is that we’re not messing about in our root compartment, just as we like to avoid mucking about in root on our personal machine, right? I created a very simple compartment and just made the parent my root, but I also used this for my Virtual Cloud Network (VCN) so I can connect later. Identity and Security is also where you would create users, groups, and all manner of access controls. But, it’s just little ol’ us, so we’ll just go in as admins.</p>

    <picture class="">
            <source srcset="assets/2createinstanceinmycompartment.png 1x" />
            <img loading="lazy" src="assets/2createinstanceinmycompartment.png" data-original="assets/2createinstanceinmycompartment.png" />
        </picture>

    <picture class="">
            <source srcset="assets/2createcompartmentchatbotnodejs.png 1x" />
            <img loading="lazy" src="assets/2createcompartmentchatbotnodejs.png" data-original="assets/2createcompartmentchatbotnodejs.png" />
        </picture>
  </li>
  <li>
    <p>Create a VCN if you don’t have one</p>

    <p>Menu: Networking &gt; Virtual Cloud Networks</p>

    <p>This is where my advance prep of a compartment came in handy, as I’d already set up a VCN using default route tables and it has a public IP so I can <code class="language-plaintext highlighter-rouge">ssh</code> in later. VCN’s are really powerful, but for our purposes all we need is a subnet and a public IP to steer to, all of which is easy to set up using the tool provided. Of course, almost all of these things can be automated using something like Terraform, but we’re just testing a chatbot for ourselves today.</p>

    <picture class="">
            <source srcset="assets/vcnsinmycompartmentnodejsproj.png 1x" />
            <img loading="lazy" src="assets/vcnsinmycompartmentnodejsproj.png" data-original="assets/vcnsinmycompartmentnodejsproj.png" />
        </picture>
  </li>
  <li>
    <p>Create a compute instance</p>

    <p>Menu: Compute &gt; Instances</p>

    <p>Here’s where things get streamlined. Oracle does a good job of choosing a general purpose shape, but we’re going to adjust it so it’s free-tier and connecting to the Internet.</p>

    <picture class="">
            <source srcset="assets/2createcomputeinstancechatbotproj.png 1x" />
            <img loading="lazy" src="assets/2createcomputeinstancechatbotproj.png" data-original="assets/2createcomputeinstancechatbotproj.png" />
        </picture>

    <p>Instead of AMD, we’ll go with Ampere, an exceptionally good value (free-tier, remember?) just click on change shape…</p>

    <picture class="">
            <source srcset="assets/2amdchangeshapeinocicompute.png 1x" />
            <img loading="lazy" src="assets/2amdchangeshapeinocicompute.png" data-original="assets/2amdchangeshapeinocicompute.png" />
        </picture>

    <p>Also, don’t forget to change the memory to 8GB</p>

    <picture class="">
            <source srcset="assets/2amperealwaysfreecomputeshapetouse.png 1x" />
            <img loading="lazy" src="assets/2amperealwaysfreecomputeshapetouse.png" data-original="assets/2amperealwaysfreecomputeshapetouse.png" />
        </picture>

    <p>As you scroll down, you’ll see that our previous VCN is available, how handy! That means we can assign a public IP to this fellow and <code class="language-plaintext highlighter-rouge">ssh</code> in shortly.</p>

    <picture class="">
            <source srcset="assets/2computewizardnetworkingpart.png 1x" />
            <img loading="lazy" src="assets/2computewizardnetworkingpart.png" data-original="assets/2computewizardnetworkingpart.png" />
        </picture>

    <p>And to <code class="language-plaintext highlighter-rouge">ssh</code> in, we’ll need the private key, which I just generate right here while I’m spinning up my compute, and of course save it and the public key somewhere safe (more on this in a bit).</p>

    <p>I personally provision 50GB of storage, but you don’t have to as OCI will provision some block memory to start with.</p>

    <picture class="">
            <source srcset="assets/2privpubkeysandstorage.png 1x" />
            <img loading="lazy" src="assets/2privpubkeysandstorage.png" data-original="assets/2privpubkeysandstorage.png" />
        </picture>

    <p><em>NOTE: You can save these as a stack for later use as well, which is also handy.</em></p>

    <p>To review, we’ve just taken 3 steps to spin up a publicly-available free-tier compute instance so we can start creating our dev environment and chances are you haven’t even finished that beverage sitting too close to your keyboard!</p>
  </li>
  <li>
    <p>Connecting to our compute instance</p>

    <p>It’ll take a minute for the compute instance to spin up, but when it does, the panel will show you the public IP, which you’ll need to <code class="language-plaintext highlighter-rouge">ssh</code> in.</p>

    <p>Menu: Compute &gt; Instances &gt; Instance Details</p>

    <p>There’s even a handy copy link!</p>

    <picture class="">
            <source srcset="assets/2computepubipexampleco.png 1x" />
            <img loading="lazy" src="assets/2computepubipexampleco.png" data-original="assets/2computepubipexampleco.png" />
        </picture>

    <p>I’m using Terminal on my Mac, so I <code class="language-plaintext highlighter-rouge">cd</code> over to where I’m storing my private key, <code class="language-plaintext highlighter-rouge">chmod 400</code> it, then:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ssh -i &lt;path to private key&gt;</span><span class="w"> </span>opc@&lt;public IP address&gt;
</code></pre></div>    </div>

    <p>And of course, when prompted by security, you want to continue connecting, which will add you to the list of known hosts and you’re off to the races!</p>
  </li>
  <li>
    <p>Installing what we need</p>

    <p>As we’re using nodejs, we’ll want to install it and then create a folder for our project, then initialize a repo in that folder to install our modules. We’ll also set up some text files with code and parameters.</p>

    <p>Oracle has a nifty <code class="language-plaintext highlighter-rouge">yum</code> repo for NodeJS and all we need to do is install the latest NodeJS using this command:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">sudo yum install nodejs
</span></code></pre></div>    </div>

    <p>Navigate to your home folder, and then <code class="language-plaintext highlighter-rouge">opc</code> (the admin user for this VM), and create a folder for your project. Like the tutorial, I named mine <code class="language-plaintext highlighter-rouge">chatbot_nodejs</code>.</p>

    <p>I branched the repo beforehand so I could extend it a bit later, but either way we initialize it in that folder with <code class="language-plaintext highlighter-rouge">npm init</code> and use <code class="language-plaintext highlighter-rouge">npm i node-nlp</code> to install the appropriate modules.</p>

    <p>Note that the <code class="language-plaintext highlighter-rouge">package.json</code> file will look for an <code class="language-plaintext highlighter-rouge">index.js</code> file, and we add two scripts: <code class="language-plaintext highlighter-rouge">train.js</code> and <code class="language-plaintext highlighter-rouge">index.js</code>, plus the repo for our dependencies.</p>

    <picture class="">
            <source srcset="assets/packagejsonfileshownchatbot.png 1x" />
            <img loading="lazy" src="assets/packagejsonfileshownchatbot.png" data-original="assets/packagejsonfileshownchatbot.png" />
        </picture>
  </li>
  <li>
    <p>Writing and testing</p>

    <p>The way all of this works is by storing a set of “intents” as questions and responses, then using the <code class="language-plaintext highlighter-rouge">node-nlp</code> module to weigh responses over time.</p>

    <p>The <code class="language-plaintext highlighter-rouge">train.js</code> file is where we have the code to actually teach our model. We also create an <code class="language-plaintext highlighter-rouge">index.js</code> file, which will get everything loaded and set up – it’s pretty simple right now, but has the capacity to extend itself to a more conversant home assistant in the future.</p>

    <p>As you can see in <a href="https://medium.com/geekculture/create-chatbot-with-nodejs-cf3d8bc3f302">the article</a>, we import the <code class="language-plaintext highlighter-rouge">NlpManager</code> from <code class="language-plaintext highlighter-rouge">node-nlp</code> so we can save and process what goes on, then create a new instance of the <code class="language-plaintext highlighter-rouge">NlpManager</code> class, read input from the terminal, send it to the manager for a response, and then display that response.</p>

    <p>Nothing too fancy just yet, but we’re laying some important groundwork. The term “intent” here is very specific, referring to the natural language processing (NLP) we’re using to train our system. This can be used in many ways, from knowing preferences to avoiding specific words to understanding what a person is saying better over time. Just like it reads, “intent” is what the person is trying to say. You can <a href="https://medium.com/mysuperai/what-is-intent-recognition-and-how-can-i-use-it-9ceb35055c4f">read more about intent recognition in this excellent piece by Christopher Marshall</a>.</p>

    <p>The model needs something to start with, so we create a couple of documents in our intents folder (inside our project folder): one for “hello” and one for “goodbye.” The author creates a set of questions and answers, which can, of course, be as long as you like. I took the liberty of changing a few, including one that calls me “FNAME” as an homage to the days when I would get press releases gone horribly awry on the database side. If you know, you know.</p>

    <p>You could create many of these to accomodate frequent queries like weather, sports, news, etc., and then create data agents who fetch what you need and return it using phrases that (over time) will be weighed for preference and ultimately “converse” in a more natural way. Integrating live data is something we’d love to do here, but we’ll wait to do this another day.</p>

    <p>Once I fixed my own minor syntax errors (check those commas, people!), the whole thing worked just as expected. First you run <code class="language-plaintext highlighter-rouge">train</code> to get the module initialized and ready (you’ll see a bunch of timing to let you know it’s doing the work), then run <code class="language-plaintext highlighter-rouge">start</code> to get the chatbot chatting.</p>

    <picture class="">
            <source srcset="assets/chatbotactuallyworkingnodejs34.png 1x" />
            <img loading="lazy" src="assets/chatbotactuallyworkingnodejs34.png" data-original="assets/chatbotactuallyworkingnodejs34.png" />
        </picture>
  </li>
</ol>

<h2 id="next-steps-iot">Next Steps: IOT</h2>

<p>OK, maybe not the very next step, but eventually this could become my own little Siri or Alexa, running in OCI, tied to systems in my house, capable of giving me whatever information I need on request. Sort of like a certain comic book character who came to life on screen not too long ago…</p>

<p>You can try all this for yourself by setting up a free tier account, and reviewing <a href="https://medium.com/geekculture/create-chatbot-with-nodejs-cf3d8bc3f302">the article</a> for the chatbot code. 
Join us on our <a href="https://bit.ly/devrel_slack">public Slack</a> if you do some cool stuff with it!</p>]]></content><author><name>Victor Agreda</name></author><category term="frameworks" /><category term="cloudapps" /><category term="open-source" /><category term="oci" /><category term="nodejs" /><summary type="html"><![CDATA[A very basic chatbot using nodejs on an oracle cloud compute instance.]]></summary></entry></feed>